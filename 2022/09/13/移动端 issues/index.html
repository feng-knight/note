<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/note/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/note/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/note/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/note/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/note/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/note/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/note/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="1. uniapp中引入字体本地和在线引入1）本地字体文件小于40kb，直接引入使用。        在字体文件小于 40kb 时，uni-app 会自动将其转化为 base64 格式； 12345678@font-face&amp;#123;    font-family:&#39;YouSheBiaoTiHei&#39;;    src:url(&#39;~@&#x2F;static&#x2F;font&#x2F;YouSheBiaoTiHei-2.tt">
<meta property="og:type" content="article">
<meta property="og:title" content="移动端 issues">
<meta property="og:url" content="https://feng-knight.github.io/note/2022/09/13/%E7%A7%BB%E5%8A%A8%E7%AB%AF%20issues/index.html">
<meta property="og:site_name" content="F゛">
<meta property="og:description" content="1. uniapp中引入字体本地和在线引入1）本地字体文件小于40kb，直接引入使用。        在字体文件小于 40kb 时，uni-app 会自动将其转化为 base64 格式； 12345678@font-face&amp;#123;    font-family:&#39;YouSheBiaoTiHei&#39;;    src:url(&#39;~@&#x2F;static&#x2F;font&#x2F;YouSheBiaoTiHei-2.tt">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20210719094350499.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTgwMzk5MA==,size_16,color_FFFFFF,t_70">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20210719094523253.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTgwMzk5MA==,size_16,color_FFFFFF,t_70">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20210719100226394.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTgwMzk5MA==,size_16,color_FFFFFF,t_70">
<meta property="og:image" content="http://www.duanlonglong.com/uploads/allimg/200221/1-20022114240S45.jpg">
<meta property="og:image" content="http://www.duanlonglong.com/uploads/allimg/200221/1-20022114244V00.gif">
<meta property="og:image" content="http://www.duanlonglong.com/uploads/allimg/200221/1-20022114263Lc.jpg">
<meta property="og:image" content="http://www.duanlonglong.com/uploads/allimg/200221/1-200221143149455.png">
<meta property="og:image" content="http://www.qianduan8.com/wp-content/uploads/2016/12/20161231213442_70899.jpg">
<meta property="og:image" content="c:%5CUsers%5Cz%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20220804000554271.png">
<meta property="og:image" content="https://img-blog.csdnimg.cn/0f0af2a6a61240179f60db7f7a5259b7.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU3R1ZHkxMjN3Zg==,size_17,color_FFFFFF,t_70,g_se,x_16">
<meta property="og:image" content="https://img-blog.csdnimg.cn/a5ebccff43f74f6e810d7690bc84be64.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5aSn5p2v576O5byP5LiN5Yqg57OW,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center">
<meta property="og:image" content="https://i-blog.csdnimg.cn/blog_migrate/8c06df707a7e629261b2b27616196ba7.png">
<meta property="og:image" content="https://i-blog.csdnimg.cn/blog_migrate/7a0910f22bd906085239752187e4d72f.png">
<meta property="og:image" content="https://i-blog.csdnimg.cn/blog_migrate/9048b8a23aec49054b8bbe1edae730fb.png">
<meta property="og:image" content="https://i-blog.csdnimg.cn/blog_migrate/3b7da1c43f078f3122605f13fac3d7c9.png">
<meta property="og:image" content="https://i-blog.csdnimg.cn/blog_migrate/ae888de44a532e831ebc03196f30451a.png">
<meta property="og:image" content="https://i-blog.csdnimg.cn/blog_migrate/a39ebaec3e824dcb37c6c924ffba5532.png">
<meta property="article:published_time" content="2022-09-12T16:54:58.000Z">
<meta property="article:modified_time" content="2025-02-25T09:29:15.140Z">
<meta property="article:author" content="F゛">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://img-blog.csdnimg.cn/20210719094350499.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTgwMzk5MA==,size_16,color_FFFFFF,t_70">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/note/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://feng-knight.github.io/note/2022/09/13/移动端 issues/"/>





  <title>移动端 issues | F゛</title>
  








<meta name="generator" content="Hexo 4.2.1"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/note/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">F゛</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">既然已经走了这么远了，不如再往前走一走.(Now that we have come so far, we might as well go a little further.)</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/note/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/note/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://feng-knight.github.io/note/note/2022/09/13/%E7%A7%BB%E5%8A%A8%E7%AB%AF%20issues/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="F゛">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/note/images/dog.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="F゛">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">移动端 issues</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2022-09-13T00:54:58+08:00">
                2022-09-13
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h4 id="1-uniapp中引入字体本地和在线引入"><a href="#1-uniapp中引入字体本地和在线引入" class="headerlink" title="1. uniapp中引入字体本地和在线引入"></a>1. <font color="#00AAF0">uniapp中引入字体本地和在线引入</font></h4><p>1）本地字体文件小于40kb，直接引入使用。<br>        在字体文件小于 40kb 时，uni-app 会自动将其转化为 base64 格式；</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@font-face</span>&#123;</span><br><span class="line">    <span class="attribute">font-family</span>:<span class="string">'YouSheBiaoTiHei'</span>;</span><br><span class="line">    <span class="attribute">src</span>:<span class="built_in">url</span>(<span class="string">'~@/static/font/YouSheBiaoTiHei-2.ttf'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*使用*/</span></span><br><span class="line"><span class="selector-class">.test</span>&#123;</span><br><span class="line">    <span class="attribute">font-family</span>:YouSheBiaoTiHei;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2）本地字体文件大于40kb，先将字体文件转换为base64，再引入使用。</p>
<p>​        使用的字体是ttf格式的，引入方式使用css。格式转换base64地址</p>
<p><font color="blue">附：我自己试了，感觉没什么卵用，Vue2中完感觉完全不需要</font></p>
<p>① 点击上传本地的字体文件</p>
<p><img src="https://img-blog.csdnimg.cn/20210719094350499.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTgwMzk5MA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>转换后的base64文件,点击SELECT ALL，然后ctrl+c复制下。就到粘贴版了。</p>
<p>② 点击下方的css中Base64的使用</p>
<p><img src="https://img-blog.csdnimg.cn/20210719094523253.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTgwMzk5MA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>引入的是<code>ttf</code>格式的字体文件，so选择最后一行的代码，新建一个css文件，将这段代码复制过去。</p>
<p><img src="https://img-blog.csdnimg.cn/20210719100226394.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTgwMzk5MA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p><code>YouSheBiaoTiHei.css</code>文件</p>
<p><strong>1&gt; 在页面中引入并使用。</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 字体样式 */</span></span><br><span class="line">@<span class="keyword">import</span> url(<span class="string">'~@/static/font/YouSheBiaoTiHei.css'</span>);</span><br><span class="line">.test&#123;</span><br><span class="line">    font-family:YouSheBiaoTiHei ;<span class="comment">//你的字体名字</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>2&gt; 本地引入字体文件太大，可以将字体文件放到服务器上，在线引入使用。</strong></p>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@font-face &#123;</span><br><span class="line">font-family:<span class="string">'iconfont'</span>;</span><br><span class="line">src:url(<span class="string">'https://at.alicdn.com/t/font_865816_17gjspmmrkti.ttf'</span>) format(<span class="string">'truetype'</span>);</span><br><span class="line">&#125;</span><br><span class="line">.test &#123;</span><br><span class="line">font-family:iconfont;</span><br><span class="line">margin-left:<span class="number">20</span>rpx;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><font color="red">注：</font>转载于：<a href="https://blog.csdn.net/weixin_45803990/article/details/118754518" target="_blank" rel="noopener">https://blog.csdn.net/weixin_45803990/article/details/118754518</a></p>
<hr>
<h4 id="2-解决ucharts图表X轴数据内容太多导致覆盖显示不完整"><a href="#2-解决ucharts图表X轴数据内容太多导致覆盖显示不完整" class="headerlink" title="2. 解决ucharts图表X轴数据内容太多导致覆盖显示不完整"></a>2. <font color="#00AAF0">解决ucharts图表X轴数据内容太多导致覆盖显示不完整</font></h4><p>我在开发过程中便遇到这个问题，由于uchartsX轴的数据量太过于庞大导致显示不完整的有以下三个解决方案，当然我选择的最后一种，因为方便快捷，一定看完。</p>
<p><img src="http://www.duanlonglong.com/uploads/allimg/200221/1-20022114240S45.jpg" alt="解决ucharts图表X轴数据内容太多导致覆盖显示不完整"> </p>
<p>☆☆☆ 先看一下官网给出的常用配置：</p>
<blockquote>
<p>uChartsX轴常用配置：<br>【<code>rotateLabel</code>】<br>X轴刻度标签是否旋转（仅在文案超过单屏宽度时有效）<br>【<code>itemCount</code>】<br>X轴可见区域数据数量（即X轴数据密度），配合拖拽滚动使用（即仅在启用enableScroll时有效）<br>【<code>labelCount</code>】<br>X轴可见区域标签数量（即X轴数刻度标签单屏幕限制显示的数量）<br>【<code>scrollShow</code>】<br>是否显示滚动条，配合拖拽滚动使用（即仅在启用enableScroll时有效）<br>【<code>scrollAlign</code>】<br>滚动条初始位置，left为数据整体左对齐，right为右对齐<br>【<code>disabled</code>】<br>不绘制X轴<br>【<code>disableGrid</code>】<br>不绘制X轴网格(即默认绘制网格)<br>【<code>calibration</code>】<br>坐标轴刻度线是否显示 注v1.9.0有效<br>【<code>boundaryGap</code>】<br>折线图、区域图起画点结束点方法：center为单元格中间起画，justify为0点起画即两端对齐<br>【<code>axisLine</code>】<br>坐标轴轴线是否显示 注v1.9.0有效<br>【<code>axisLineColor</code>】<br>坐标轴轴线颜色 注v1.9.0有效</p>
</blockquote>
<p>好，根据官网给的文档整理的方案为以下两种</p>
<p>1）【<code>rotateLabel</code>】<br>X轴刻度标签是否旋转（仅在文案超过单屏宽度时有效），这个效果我也不给大家演示了，就是Ⅹ轴的名字旋转倾斜，可以多显示些数据，但显示的数量也终究有限。<br>2） 开启图表拖拽功能，开启后即可左右滑动图表进行展示，下面给大家进行代码的展示</p>
<p><img src="http://www.duanlonglong.com/uploads/allimg/200221/1-20022114244V00.gif" alt="解决ucharts图表X轴数据内容太多导致覆盖显示不完整"></p>
<p><strong>坐标轴配置</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">enableScroll: <span class="literal">true</span>,<span class="comment">//开启图表拖拽功能</span></span><br><span class="line">xAxis:&#123;</span><br><span class="line">type:<span class="string">'grid'</span>,</span><br><span class="line">gridType:<span class="string">'dash'</span>,</span><br><span class="line">itemCount:<span class="number">4</span>,<span class="comment">//x轴单屏显示数据的数量，默认为5个</span></span><br><span class="line">scrollShow:<span class="literal">true</span>,<span class="comment">//新增是否显示滚动条，默认false</span></span><br><span class="line">scrollAlign:<span class="string">'left'</span>,<span class="comment">//滚动条初始位置</span></span><br><span class="line">scrollBackgroundColor:<span class="string">'#F7F7FF'</span>,<span class="comment">//默认为 #EFEBEF</span></span><br><span class="line">scrollColor:<span class="string">'#DEE7F7'</span>,<span class="comment">//默认为 #A6A6A6&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>canvas组件配置</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;canvas canvas-id=<span class="string">"canvasLineA"</span> id=<span class="string">"canvasLineA"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"charts"</span> disable-scroll=<span class="literal">true</span> @touchstart=<span class="string">"touchLineA"</span> @touchmove=<span class="string">"moveLineA"</span> @touchend=<span class="string">"touchEndLineA"</span>&gt;&lt;<span class="regexp">/canvas&gt;</span></span><br></pre></td></tr></table></figure>

<p>可能至此还是不能满足某些用户的刁钻想法，毕竟我就是这样，因为图表记录点数据较大，又想让用户一眼看清图表的起伏走势，那么好，上第三种方法，先看效果在上代码。</p>
<p><img src="http://www.duanlonglong.com/uploads/allimg/200221/1-20022114263Lc.jpg" alt="解决ucharts图表X轴数据内容太多导致覆盖显示不完整"></p>
<p>这种方法在官网没有找到，可能我找的不够仔细，下面上代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">option &#123;</span><br><span class="line">    series: chartDta.series,</span><br><span class="line">    xAxis: &#123;</span><br><span class="line">        labelCount:<span class="number">7</span>,</span><br><span class="line">        itemCount:chartData.length</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="http://www.duanlonglong.com/uploads/allimg/200221/1-200221143149455.png" alt="img"> </p>
<p>使用以上两行代码几个解决，labelCount: 7,是代表整个窗口的图表默认显示7个，itemCount:chartData.length,这里的值我是放的X轴数据的长度，可以直接填写数字，具体怎么个比例自己领悟吧。</p>
<p>附：在这里吐槽一句，楼主最后一句真是个j8，都说到这份上了，差这两句话吗？我估计这又够刚接触的“小白”喝一壶，不靠谱啊。</p>
<p><font color="red">注：</font>转载于：<a href="http://www.duanlonglong.com/qdjy/148.html" target="_blank" rel="noopener">http://www.duanlonglong.com/qdjy/148.html</a></p>
<hr>
<h4 id="3-uni-app-图片转base64-解决方案"><a href="#3-uni-app-图片转base64-解决方案" class="headerlink" title="3. uni-app 图片转base64 解决方案"></a>3. <font color="#00AAF0">uni-app 图片转base64 解决方案</font></h4><p>网上多数都是通过微信api将图片url 转换成Base64 格式，但仅限于网络地址的图片，本地路径的图片转换会报错,如下：</p>
<p><strong>真机下会出错报无效的路径（不可用）</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">request:fail invalid url <span class="string">"wxfile://tmp_7c6025b86ad385c609d0094facbeb1c7ca426dc83b33e628.jpg"</span></span><br><span class="line"></span><br><span class="line">wx.request(&#123;</span><br><span class="line">        url: temp,<span class="comment">//临时路径</span></span><br><span class="line">        responseType: <span class="string">'arraybuffer'</span>, <span class="comment">//设置返回的数据格式为arraybuffer</span></span><br><span class="line">        success: <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">const</span> base64 = wx.arrayBufferToBase64(res.data)&#125;,</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>

<p><strong>有效解决方案：</strong></p>
<p><strong>使用 <code>uni.getFileSystemManager().readFile</code></strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">uni</span><span class="selector-class">.chooseImage</span>(&#123;</span><br><span class="line">            <span class="attribute">count</span>: <span class="number">1</span>, //默认<span class="number">9</span></span><br><span class="line">            sizeType: [<span class="string">'compressed'</span>],</span><br><span class="line">            sourceType: [<span class="string">'album'</span>], //从相册选择</span><br><span class="line">            success: (res) =&gt; &#123;</span><br><span class="line">            this.src = res.tempFilePaths[<span class="number">0</span>]</span><br><span class="line">            uni.<span class="built_in">getFileSystemManager</span>().<span class="built_in">readFile</span>(&#123;</span><br><span class="line">                    filePath: this.src,</span><br><span class="line">                    encoding: <span class="string">'base64'</span>,</span><br><span class="line">                    success: r =&gt; &#123; // r.data &#125;</span><br><span class="line">                        &#125;)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br></pre></td></tr></table></figure>

<p><a href="https://ext.dcloud.net.cn/plugin?id=3604" target="_blank" rel="noopener">https://ext.dcloud.net.cn/plugin?id=3604</a></p>
<hr>
<h4 id="4-微信小程序生成海报-包含小程序二维码-插件"><a href="#4-微信小程序生成海报-包含小程序二维码-插件" class="headerlink" title="4. 微信小程序生成海报(包含小程序二维码)(插件) "></a>4. <font color="#00AAF0">微信小程序生成海报(包含小程序二维码)(插件) </font></h4><p><strong>利用uniapp插件：<a href="https://ext.dcloud.net.cn/plugin?id=3604" target="_blank" rel="noopener">https://ext.dcloud.net.cn/plugin?id=3604</a></strong></p>
<p><strong>1) 页面引用</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vant 遮罩层</span></span><br><span class="line">&lt;van-overlay</span><br><span class="line">    :show=<span class="string">"overlayShow"</span></span><br><span class="line">    :z-index=<span class="string">"999"</span></span><br><span class="line">    @tap=<span class="string">"handleGeneratePoster"</span></span><br><span class="line">    &gt;</span><br><span class="line">    &lt;view <span class="class"><span class="keyword">class</span></span>=<span class="string">"poster-container"</span>&gt;</span><br><span class="line">      <span class="comment">// 海报组件</span></span><br><span class="line">      &lt;poster</span><br><span class="line">        ref=<span class="string">"poster"</span></span><br><span class="line">        :imageUrl=<span class="string">"image"</span></span><br><span class="line">        :imageWidth=<span class="string">"650"</span></span><br><span class="line">        :imageHeight=<span class="string">"1100"</span></span><br><span class="line">        :drawData=<span class="string">"drawData"</span></span><br><span class="line">        :config=<span class="string">"config"</span></span><br><span class="line">        :wechatCode=<span class="string">"false"</span></span><br><span class="line">        @loading=<span class="string">"onLoading"</span></span><br><span class="line">        @success=<span class="string">"onSuccess"</span></span><br><span class="line">        @fail=<span class="string">"onFail"</span></span><br><span class="line">      &gt;</span><br><span class="line">        &lt;!-- <span class="xml"><span class="tag">&lt;<span class="name">template</span> <span class="attr">v-slot:header</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">view</span>&gt;</span>小程序海报<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span> --&gt;</span><br><span class="line">        &lt;!-- <span class="xml"><span class="tag">&lt;<span class="name">template</span> <span class="attr">v-slot:save</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">view</span> @<span class="attr">click</span>=<span class="string">"saveToAlbum"</span>&gt;</span>保存<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span> --&gt;</span><br><span class="line">      &lt;<span class="regexp">/poster&gt;</span></span><br><span class="line"><span class="regexp">      &lt;view class="save-btn"&gt;</span></span><br><span class="line"><span class="regexp">        &lt;!-- &lt;button @tap="handleCustomBack"&gt;关闭&lt;/</span>button&gt; --&gt;</span><br><span class="line">        &lt;button @tap=<span class="string">"saveToAlbum"</span>&gt;下载&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>view&gt;</span><br><span class="line">    &lt;<span class="regexp">/view&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>van-overlay&gt;</span><br></pre></td></tr></table></figure>

<p><strong>2) <code>data</code></strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line">overlayShow: <span class="literal">false</span>,</span><br><span class="line"><span class="comment">// image: '/static/deformity/poster-background.png',</span></span><br><span class="line">image: <span class="string">''</span>,</span><br><span class="line"><span class="comment">// 配置最后生成的海报图片</span></span><br><span class="line">config: &#123;</span><br><span class="line">    imageMode: <span class="string">'aspectFit'</span>,</span><br><span class="line">    posterHeight: <span class="string">'90%'</span>,</span><br><span class="line">        <span class="comment">// canvasWidth 和 convasHeight使用的是px，防止不同设备Dpr不统一，导致最后图片留白边问题</span></span><br><span class="line">        canvasWidth: <span class="number">275</span>,</span><br><span class="line">            convasHeight: <span class="number">520</span>,</span><br><span class="line">&#125;,</span><br><span class="line">drawData: [],</span><br><span class="line">posterData: [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 图片类型</span></span><br><span class="line">        type: <span class="string">'image'</span>,</span><br><span class="line">        config: &#123;</span><br><span class="line">            <span class="comment">// 图片地址</span></span><br><span class="line">            <span class="comment">// url: '/static/deformity/poster-background.png',</span></span><br><span class="line">            url: <span class="string">'https://hahacloud-static-resource.obs.cn-east-3.myhuaweicloud.com:443/hahacloud/saas/1441275226703794176/57535620-e926-4ea4-bb35-a1913bd92051.png'</span>,</span><br><span class="line">            <span class="comment">// 以画布左上角为顶点，图片的水平位置x,垂直位置y(必填)</span></span><br><span class="line">            <span class="comment">// 图片的宽（px）,高（px）(必填)</span></span><br><span class="line">            x: <span class="number">0</span>,</span><br><span class="line">            y: <span class="number">0</span>,</span><br><span class="line">            w: <span class="number">275</span>,</span><br><span class="line">            h: <span class="number">490</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 活动名称</span></span><br><span class="line">        type: <span class="string">'text'</span>,</span><br><span class="line">        config: &#123;</span><br><span class="line">            text: <span class="string">''</span>,</span><br><span class="line">            <span class="comment">// 以画布左上角为顶点，文本的水平位置x, 垂直位置y (必填)</span></span><br><span class="line">            x: <span class="number">135</span>,</span><br><span class="line">            y: <span class="number">170</span>,</span><br><span class="line">            <span class="comment">// 文本属性 颜色（选填，默认black）字体（选填，默认根节点字体）对齐方式（选填，默认center）</span></span><br><span class="line">            color: <span class="string">'#6B4743'</span>,</span><br><span class="line">            font: <span class="string">'normal bold 28px 仿宋'</span>, <span class="comment">//同 canvas 对象的 font 属性</span></span><br><span class="line">            textAlign: <span class="string">'center'</span><span class="comment">// 可选 left right center</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 活动日期</span></span><br><span class="line">        type: <span class="string">'text'</span>,</span><br><span class="line">        config: &#123;</span><br><span class="line">            text: <span class="string">'活动日期'</span>,</span><br><span class="line">            <span class="comment">// 以画布左上角为顶点，文本的水平位置x, 垂直位置y (必填)</span></span><br><span class="line">            x: <span class="number">135</span>,</span><br><span class="line">            y: <span class="number">205</span>,</span><br><span class="line">            <span class="comment">// 文本属性 颜色（选填，默认black）字体（选填，默认根节点字体）对齐方式（选填，默认center）</span></span><br><span class="line">            color: <span class="string">'#6B4743'</span>,</span><br><span class="line">            font: <span class="string">'normal bold 14px 仿宋'</span>, <span class="comment">//同 canvas 对象的 font 属性</span></span><br><span class="line">            textAlign: <span class="string">'center'</span><span class="comment">// 可选 left right center</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 活动日期</span></span><br><span class="line">        type: <span class="string">'text'</span>,</span><br><span class="line">        config: &#123;</span><br><span class="line">            text: <span class="string">''</span>,</span><br><span class="line">            <span class="comment">// 以画布左上角为顶点，文本的水平位置x, 垂直位置y (必填)</span></span><br><span class="line">            x: <span class="number">135</span>,</span><br><span class="line">            y: <span class="number">225</span>,</span><br><span class="line">            <span class="comment">// 文本属性 颜色（选填，默认black）字体（选填，默认根节点字体）对齐方式（选填，默认center）</span></span><br><span class="line">            color: <span class="string">'#6B4743'</span>,</span><br><span class="line">            font: <span class="string">'normal bold 14px 仿宋'</span>, <span class="comment">//同 canvas 对象的 font 属性</span></span><br><span class="line">            textAlign: <span class="string">'center'</span><span class="comment">// 可选 left right center</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 活动时间</span></span><br><span class="line">        type: <span class="string">'text'</span>,</span><br><span class="line">        config: &#123;</span><br><span class="line">            text: <span class="string">'活动时间'</span>,</span><br><span class="line">            <span class="comment">// 以画布左上角为顶点，文本的水平位置x, 垂直位置y (必填)</span></span><br><span class="line">            x: <span class="number">135</span>,</span><br><span class="line">            y: <span class="number">245</span>,</span><br><span class="line">            <span class="comment">// 文本属性 颜色（选填，默认black）字体（选填，默认根节点字体）对齐方式（选填，默认center）</span></span><br><span class="line">            color: <span class="string">'#6B4743'</span>,</span><br><span class="line">            font: <span class="string">'normal bold 14px 仿宋'</span>, <span class="comment">//同 canvas 对象的 font 属性</span></span><br><span class="line">            textAlign: <span class="string">'center'</span><span class="comment">// 可选 left right center</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 活动时间</span></span><br><span class="line">        type: <span class="string">'text'</span>,</span><br><span class="line">        config: &#123;</span><br><span class="line">            text: <span class="string">''</span>,</span><br><span class="line">            <span class="comment">// 以画布左上角为顶点，文本的水平位置x, 垂直位置y (必填)</span></span><br><span class="line">            x: <span class="number">135</span>,</span><br><span class="line">            y: <span class="number">265</span>,</span><br><span class="line">            <span class="comment">// 文本属性 颜色（选填，默认black）字体（选填，默认根节点字体）对齐方式（选填，默认center）</span></span><br><span class="line">            color: <span class="string">'#6B4743'</span>,</span><br><span class="line">            font: <span class="string">'normal bold 14px 仿宋'</span>, <span class="comment">//同 canvas 对象的 font 属性</span></span><br><span class="line">            textAlign: <span class="string">'center'</span><span class="comment">// 可选 left right center</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 活动地点</span></span><br><span class="line">        type: <span class="string">'text'</span>,</span><br><span class="line">        config: &#123;</span><br><span class="line">            text: <span class="string">'活动地点'</span>,</span><br><span class="line">            <span class="comment">// 以画布左上角为顶点，文本的水平位置x, 垂直位置y (必填)</span></span><br><span class="line">            x: <span class="number">135</span>,</span><br><span class="line">            y: <span class="number">285</span>,</span><br><span class="line">            <span class="comment">// 文本属性 颜色（选填，默认black）字体（选填，默认根节点字体）对齐方式（选填，默认center）</span></span><br><span class="line">            color: <span class="string">'#6B4743'</span>,</span><br><span class="line">            font: <span class="string">'normal bold 14px 仿宋'</span>, <span class="comment">//同 canvas 对象的 font 属性</span></span><br><span class="line">            textAlign: <span class="string">'center'</span><span class="comment">// 可选 left right center</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 活动地点</span></span><br><span class="line">        type: <span class="string">'text'</span>,</span><br><span class="line">        config: &#123;</span><br><span class="line">            text: <span class="string">''</span>,</span><br><span class="line">            <span class="comment">// 以画布左上角为顶点，文本的水平位置x, 垂直位置y (必填)</span></span><br><span class="line">            x: <span class="number">135</span>,</span><br><span class="line">            y: <span class="number">310</span>,</span><br><span class="line">            <span class="comment">// 文本属性 颜色（选填，默认black）字体（选填，默认根节点字体）对齐方式（选填，默认center）</span></span><br><span class="line">            color: <span class="string">'#6B4743'</span>,</span><br><span class="line">            font: <span class="string">'normal bold 14px 仿宋'</span>, <span class="comment">//同 canvas 对象的 font 属性</span></span><br><span class="line">            textAlign: <span class="string">'center'</span><span class="comment">// 可选 left right center</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"><span class="comment">// // 二维码配置</span></span><br><span class="line"><span class="comment">// wechatCodeConfig: &#123;</span></span><br><span class="line"><span class="comment">// 	serverUrl: 'https://xxx.xxx.com/xxx/xxx',</span></span><br><span class="line"><span class="comment">// 	scene: '123123',</span></span><br><span class="line"><span class="comment">// 	config: &#123;</span></span><br><span class="line"><span class="comment">// 		x: 84.5,</span></span><br><span class="line"><span class="comment">// 		y: 320,</span></span><br><span class="line"><span class="comment">// 		w: 100,</span></span><br><span class="line"><span class="comment">// 		h: 100</span></span><br><span class="line"><span class="comment">// 	&#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>3) <code>method</code></strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 保存到相册</span></span><br><span class="line">saveToAlbum() &#123;</span><br><span class="line">    <span class="keyword">this</span>.$refs.poster.saveToAlbum()</span><br><span class="line"><span class="keyword">this</span>.handleCustomBack()</span><br><span class="line">&#125;,</span><br><span class="line">onLoading()&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Loading:正在加载静态资源'</span>)</span><br><span class="line">&#125;,</span><br><span class="line">onSuccess()&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Success:创建海报成功'</span>)</span><br><span class="line">&#125;,</span><br><span class="line">onFail(e)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Fail:创建海报失败'</span>,e)</span><br><span class="line">&#125;,</span><br><span class="line">createdPoster()&#123;</span><br><span class="line">    <span class="comment">// 调用 createImage 开始创建海报</span></span><br><span class="line">    <span class="keyword">this</span>.$refs.poster.createImage()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="5-移动端rem布局"><a href="#5-移动端rem布局" class="headerlink" title="5. 移动端rem布局"></a>5. <font color="#00AAF0">移动端rem布局</font></h4><p>1）我相信很多开始写移动端页面的都用流式布局，弹性布局flex解决自适应的问题，但这里介绍一下在实践中用的最简单的布局方案——rem布局 。</p>
<blockquote>
<p>rem（即html的字体大小），如果html字体大小100PX，那么1rem = 100px。<br>本示例设置宽度375px，是以iPhone6为例，如果页面的宽度超过了640px，页面中html的font-size恒为120px，否则，页面中html的font-size的大小为：</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">100</span> * (移动端屏幕宽<span class="built_in">document</span>.documentElement.clientWidth / <span class="number">640</span>)</span><br></pre></td></tr></table></figure>

<p>为了好计算，所以设置100px</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#html1</span> &#123;</span><br><span class="line"><span class="attribute">font-size</span>:<span class="number">100px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">recalc</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">var</span> h = <span class="built_in">document</span>.getElementById(<span class="string">'html1'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// w代表实际宽度,获取当前屏幕可视区域大小</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> w = <span class="built_in">document</span>.documentElement.clientWidth;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(w);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// d代表设计宽度</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> d = <span class="number">375</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 来动态设置html根标签的字体大小</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (w&gt;= <span class="number">640</span>) &#123; </span><br><span class="line"></span><br><span class="line">      h.style.fontSize = <span class="string">'120px'</span>;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">  h.style.fontSize = w / d * <span class="number">100</span> + <span class="string">'px'</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(h.style.fontSize);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">"resize"</span>, recalc, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">'DOMContentLoaded'</span>, recalc, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="6-日期转换、比较、加减方法总结"><a href="#6-日期转换、比较、加减方法总结" class="headerlink" title="6. 日期转换、比较、加减方法总结"></a>6. <font color="#00AAF0">日期转换、比较、加减方法总结</font></h4><p>最近写uniApp项目发现发布的小程序这块时间格式的问题，所以想把这些方法总结一下（待优化）：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 日期转时间戳</span></span><br><span class="line"><span class="keyword">const</span> getUnixTime = <span class="function">(<span class="params">dateStr</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> newstr = dateStr.replace(<span class="regexp">/-/g</span>, <span class="string">'/'</span>)</span><br><span class="line">  <span class="keyword">let</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>(newstr)</span><br><span class="line">  <span class="keyword">let</span> time_str = date.getTime().toString()</span><br><span class="line">  <span class="keyword">return</span> time_str.substr(<span class="number">0</span>, <span class="number">10</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 时间戳转日期,falg:true表示只要年月日,part: year month date</span></span><br><span class="line"><span class="keyword">const</span> toDate = <span class="function">(<span class="params">number, flag, part</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> n = number</span><br><span class="line">  <span class="keyword">let</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="built_in">parseInt</span>(n) * <span class="number">1000</span>)</span><br><span class="line">  <span class="keyword">let</span> y = date.getFullYear()</span><br><span class="line">  <span class="keyword">let</span> m = date.getMonth() + <span class="number">1</span></span><br><span class="line">  m = m &lt; <span class="number">10</span> ? (<span class="string">'0'</span> + m) : m</span><br><span class="line">  <span class="keyword">let</span> d = date.getDate()</span><br><span class="line">  d = d &lt; <span class="number">10</span> ? (<span class="string">'0'</span> + d) : d</span><br><span class="line">  <span class="keyword">let</span> h = date.getHours()</span><br><span class="line">  h = h &lt; <span class="number">10</span> ? (<span class="string">'0'</span> + h) : h</span><br><span class="line">  <span class="keyword">let</span> minute = date.getMinutes()</span><br><span class="line">  <span class="keyword">let</span> second = date.getSeconds()</span><br><span class="line">  minute = minute &lt; <span class="number">10</span> ? (<span class="string">'0'</span> + minute) : minute</span><br><span class="line">  second = second &lt; <span class="number">10</span> ? (<span class="string">'0'</span> + second) : second</span><br><span class="line">  <span class="keyword">if</span> (flag) &#123;</span><br><span class="line">    <span class="keyword">if</span> (part == <span class="string">'year'</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> y</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (part == <span class="string">'month'</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> m</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (part == <span class="string">'date'</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> n</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> y + <span class="string">'-'</span> + m + <span class="string">'-'</span> + d</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> y + <span class="string">'-'</span> + m + <span class="string">'-'</span> + d + <span class="string">' '</span> + h + <span class="string">':'</span> + minute + <span class="string">':'</span> + second</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断两个日期时间戳相差多少天,参数为时间戳</span></span><br><span class="line"><span class="keyword">const</span> dateCompare = <span class="function">(<span class="params">dateTimeStamp1, dateTimeStamp2</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> dayNum = <span class="number">0</span></span><br><span class="line">  <span class="keyword">if</span> (dateTimeStamp1 &gt; dateTimeStamp2) &#123;</span><br><span class="line">    dayNum = <span class="built_in">Math</span>.floor((dateTimeStamp1 - dateTimeStamp2) / <span class="number">86400</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    dayNum = <span class="built_in">Math</span>.floor((dateTimeStamp2 - dateTimeStamp1) / <span class="number">86400</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> dayNum</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断过去某个时间点到当前时间是否达到多少天,可以用来定期清理缓存</span></span><br><span class="line"><span class="keyword">const</span> datePassDays = <span class="function">(<span class="params">dateTimeStamp, days</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> now = getUnixTime(formatDateThis(<span class="keyword">new</span> <span class="built_in">Date</span>()))</span><br><span class="line">  <span class="keyword">let</span> diffValue = now - dateTimeStamp</span><br><span class="line">  <span class="keyword">let</span> limitTime = days * <span class="number">86400</span></span><br><span class="line">  <span class="keyword">if</span> (diffValue &gt;= limitTime) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 当前日期加减天数,falg:true表示只要年月日</span></span><br><span class="line"><span class="keyword">const</span> mathChangeDate = <span class="function">(<span class="params">date, method, days, flag</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// method:'+' || '-'</span></span><br><span class="line">  <span class="comment">// ios不解析带'-'的日期格式，要转成'/'，不然Nan，切记</span></span><br><span class="line">  <span class="keyword">let</span> dateVal = date.replace(<span class="regexp">/-/g</span>, <span class="string">'/'</span>)</span><br><span class="line">  <span class="keyword">let</span> timestamp = <span class="built_in">Date</span>.parse(dateVal)</span><br><span class="line">  <span class="keyword">if</span> (method == <span class="string">'+'</span>) &#123;</span><br><span class="line">    timestamp = timestamp / <span class="number">1000</span> + <span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span> * days</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method == <span class="string">'-'</span>) &#123;</span><br><span class="line">    timestamp = timestamp / <span class="number">1000</span> - <span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span> * days</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> toDate(timestamp, flag)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 时间戳转换具体时间描述(传入数值型时间戳)</span></span><br><span class="line"><span class="keyword">const</span> getDateDiff = <span class="function">(<span class="params">dateTimeStamp</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> result = <span class="string">''</span></span><br><span class="line">  <span class="keyword">let</span> minute = <span class="number">1</span> * <span class="number">60</span></span><br><span class="line">  <span class="keyword">let</span> hour = minute * <span class="number">60</span></span><br><span class="line">  <span class="keyword">let</span> day = hour * <span class="number">24</span></span><br><span class="line">  <span class="keyword">let</span> halfamonth = day * <span class="number">15</span></span><br><span class="line">  <span class="keyword">let</span> month = day * <span class="number">30</span></span><br><span class="line">  <span class="keyword">let</span> now = getUnixTime(formatDateThis(<span class="keyword">new</span> <span class="built_in">Date</span>())) <span class="comment">// 有些特殊 不能使用 new Date()</span></span><br><span class="line">  <span class="keyword">let</span> diffValue = now - dateTimeStamp</span><br><span class="line">  <span class="keyword">if</span> (diffValue &lt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> monthC = diffValue / month</span><br><span class="line">  <span class="keyword">let</span> weekC = diffValue / (<span class="number">7</span> * day)</span><br><span class="line">  <span class="keyword">let</span> dayC = diffValue / day</span><br><span class="line">  <span class="keyword">let</span> hourC = diffValue / hour</span><br><span class="line">  <span class="keyword">let</span> minC = diffValue / minute</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (monthC &gt;= <span class="number">1</span>) &#123;</span><br><span class="line">    result = <span class="string">''</span> + <span class="built_in">parseInt</span>(monthC) + <span class="string">'月前'</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (weekC &gt;= <span class="number">1</span>) &#123;</span><br><span class="line">    result = <span class="string">''</span> + <span class="built_in">parseInt</span>(weekC) + <span class="string">'周前'</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (dayC &gt;= <span class="number">1</span>) &#123;</span><br><span class="line">    result = <span class="string">''</span> + <span class="built_in">parseInt</span>(dayC) + <span class="string">'天前'</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (hourC &gt;= <span class="number">1</span>) &#123;</span><br><span class="line">    result = <span class="string">''</span> + <span class="built_in">parseInt</span>(hourC) + <span class="string">'小时前'</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (minC &gt;= <span class="number">1</span>) &#123;</span><br><span class="line">    result = <span class="string">''</span> + <span class="built_in">parseInt</span>(minC) + <span class="string">'分钟前'</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123; result = <span class="string">'刚刚'</span> &#125;</span><br><span class="line">  <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取当前年份，月份， 例： getCurrentTime("year")</span></span><br><span class="line"><span class="keyword">const</span> getCurrentTime = <span class="function">(<span class="params">method, date = <span class="keyword">new</span> <span class="built_in">Date</span>(</span>)) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (method == <span class="string">'year'</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> date.getFullYear()</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method == <span class="string">'month'</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> date.getMonth() + <span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> date</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取当前服务器时间,参数直接用 new Date() 就可以了</span></span><br><span class="line"><span class="keyword">const</span> formatDateThis = <span class="function">(<span class="params">date, lab = <span class="string">'-'</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> year = date.getFullYear()</span><br><span class="line">  <span class="keyword">const</span> month = date.getMonth() + <span class="number">1</span></span><br><span class="line">  <span class="keyword">const</span> day = date.getDate()</span><br><span class="line">  <span class="keyword">const</span> hour = date.getHours()</span><br><span class="line">  <span class="keyword">const</span> minute = date.getMinutes()</span><br><span class="line">  <span class="keyword">const</span> second = date.getSeconds()</span><br><span class="line">  <span class="keyword">return</span> [year, month, day].map(formatNumber).join(lab) + <span class="string">' '</span> + [hour, minute, second].map(formatNumber).join(<span class="string">':'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 当前年月日</span></span><br><span class="line"><span class="keyword">const</span> formatTime = <span class="function">(<span class="params">date, lab = <span class="string">'-'</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> year = date.getFullYear()</span><br><span class="line">  <span class="keyword">const</span> month = date.getMonth() + <span class="number">1</span></span><br><span class="line">  <span class="keyword">const</span> day = date.getDate()</span><br><span class="line">  <span class="keyword">return</span> [year, month, day].map(formatNumber).join(lab)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 当前时分秒</span></span><br><span class="line"><span class="keyword">const</span> formatTimes = <span class="function"><span class="params">time</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> hour = time.getHours()</span><br><span class="line">  <span class="keyword">const</span> minute = time.getMinutes()</span><br><span class="line">  <span class="keyword">const</span> second = time.getSeconds()</span><br><span class="line">  <span class="keyword">return</span> [hour, minute, second].map(formatNumber).join(<span class="string">':'</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 补0</span></span><br><span class="line"><span class="keyword">const</span> formatNumber = <span class="function"><span class="params">n</span> =&gt;</span> &#123;</span><br><span class="line">  n = n.toString()</span><br><span class="line">  <span class="keyword">return</span> n[<span class="number">1</span>] ? n : <span class="string">'0'</span> + n</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 比较两个时间大小(格式参考yyyy-mm-dd hh:mm:ss)</span></span><br><span class="line"><span class="keyword">const</span> compareTime = <span class="function">(<span class="params">startTime, endTime</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 结束时间大于开始时间就是true  ， 反之则为 false</span></span><br><span class="line">  <span class="keyword">let</span> sn = getUnixTime(startTime) * <span class="number">1</span></span><br><span class="line">  <span class="keyword">let</span> en = getUnixTime(endTime) * <span class="number">1</span></span><br><span class="line">  <span class="keyword">if</span> (en &gt; sn) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 注: 如果没有日期而是时分秒 hh:mm:ss 直接比较大小的话，不需要什么方法，直接比较大小就行了</span></span><br><span class="line"><span class="comment">* eg: </span></span><br><span class="line"><span class="comment">* const time1 = '08:20:00'</span></span><br><span class="line"><span class="comment">* const time1 = '10:50:00'</span></span><br><span class="line"><span class="comment">* console.log(time &lt; time2)</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">  dateCompare,</span><br><span class="line">  getCurrentTime,</span><br><span class="line">  getUnixTime,</span><br><span class="line">  formatDateThis,</span><br><span class="line">  formatTime,</span><br><span class="line">  formatTimes,</span><br><span class="line">  toDate,</span><br><span class="line">  getDateDiff,</span><br><span class="line">  mathChangeDate,</span><br><span class="line">  compareTime,</span><br><span class="line">  datePassDays</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><font color="red">注：</font> 如果没有日期而是时分秒 hh:mm:ss 直接比较大小的话，不需要什么方法，直接比较大小就行了（防止上面写了没看到，再记一遍，哈哈~）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> time1 = <span class="string">'08:20:00'</span></span><br><span class="line"><span class="keyword">const</span> time1 = <span class="string">'10:50:00'</span></span><br><span class="line"><span class="built_in">console</span>.log(time &lt; time2)</span><br></pre></td></tr></table></figure>



<hr>
<h4 id="7-微信小程序image图片自适应宽度比例显示的方法"><a href="#7-微信小程序image图片自适应宽度比例显示的方法" class="headerlink" title="7. 微信小程序image图片自适应宽度比例显示的方法"></a>7. <font color="#00AAF0">微信小程序<code>image</code>图片自适应宽度比例显示的方法</font></h4><p>我们都知道微信小程序的组件<code>image</code>是用来显示图片的，它有一下几个属性：<br><strong>1、<code>src</code>        图片资源地址</strong><br><strong>2、<code>mode</code>      图片裁剪、缩放的模式</strong><br><strong>3、<code>binderror</code>   当错误发生时，发布到 AppService 的事件名，事件对象<code>event.detail = {errMsg: ‘something wrong’}</code></strong><br><strong>4、<code>bindload</code>   当图片载入完毕时，发布到 AppService 的事件名，事件对象<code>event.detail = {height:’图片高度px’, width:’图片宽度px’}</code></strong><br>但是image有默认的固定的宽度和高度，这样我们在做图片自适应的时候，就不好做了，特别是我们在做一些商品详情页的时候，需要image自适应屏幕,按原图比例显示。那么如何让image自适应比例显示呢？可以有两种方法：<br><strong>一、使用<code>mode：widthFix</code></strong><br><strong><code>widthFix</code>：</strong>宽度不变，高度自动变化，保持原图宽高比不变。<br>首先我们先设置image的mode为widthFix，然后给图片加一个固定rpx的宽度，比如：730rpx。<br>这样图片也可以自适应了，因为小程序的rpx本身就是一个自适应显示的单位<br><strong>二、使用<code>bindload</code>绑定函数动态自适应。</strong><br>我们可以给image绑定一个函数，这个函数，如上面的bindload说明一样，我们可以获取到原图的宽度和高度。<br>然后计算他们的宽高比率。。然后设置一个宽度大小（rpx），最后通过style动态设置image的宽高。代码如下：</p>
<p><strong>html代码：</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">"&#123;&#123; item &#125;&#125;"</span> <span class="attr">bindload</span>=<span class="string">"imageLoad"</span> <span class="attr">data-index</span>=<span class="string">"&#123;&#123; index &#125;&#125;"</span> <span class="attr">style</span>=<span class="string">"width:&#123;&#123; images[index].width &#125;&#125;rpx; height:&#123;&#123; images[index].height &#125;&#125;rpx;"</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>js代码：</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Page(&#123;</span><br><span class="line">  data: &#123;</span><br><span class="line">    images:&#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  imageLoad: <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">     <span class="keyword">var</span> $width=e.detail.width,    <span class="comment">//获取图片真实宽度</span></span><br><span class="line">         $height=e.detail.height,</span><br><span class="line">         ratio=$width/$height;    <span class="comment">//图片的真实宽高比例</span></span><br><span class="line">     <span class="keyword">var</span> viewWidth=<span class="number">718</span>,           <span class="comment">//设置图片显示宽度，左右留有16rpx边距</span></span><br><span class="line">         viewHeight=<span class="number">718</span>/ratio;    <span class="comment">//计算的高度值</span></span><br><span class="line">      <span class="keyword">var</span> image=<span class="keyword">this</span>.data.images; </span><br><span class="line">      <span class="comment">//将图片的datadata-index作为image对象的key,然后存储图片的宽高值</span></span><br><span class="line">      image[e.target.dataset.index]=&#123;</span><br><span class="line">         width:viewWidth,</span><br><span class="line">         height:viewHeight</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">this</span>.setData(&#123;</span><br><span class="line">           images:image</span><br><span class="line">      &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>最后，我们就可以可以通过<code>images[index].width</code> 和 <code>images[index].height</code>给每一个图片设置宽高了。<br>以上是自己在玩小程序时，关于image自适应方法的简单记录。。<br><img src="http://www.qianduan8.com/wp-content/uploads/2016/12/20161231213442_70899.jpg" alt="img"></p>
<p><font color="red">注：</font>转载于：<a href="http://www.qianduan8.com/1005.html" target="_blank" rel="noopener">http://www.qianduan8.com/1005.html</a></p>
<hr>
<h4 id="8-在uniapp中-一个页面多个视频，控制只播放一个"><a href="#8-在uniapp中-一个页面多个视频，控制只播放一个" class="headerlink" title="8. 在uniapp中 一个页面多个视频，控制只播放一个"></a>8. <font color="#00AAF0">在uniapp中 一个页面多个视频，控制只播放一个</font></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;view class&#x3D;&quot;&quot; v-for&#x3D;&quot;(item, index) in 4&quot; :key&#x3D;&quot;index&quot;&gt;  </span><br><span class="line">	&lt;video src&#x3D;&quot;https:&#x2F;&#x2F;m.baopinstudio.shandongweipai.com&#x2F;uploads&#x2F;20210531&#x2F;5d286b6a973181d96115b1e9c064f8b4.mp4&quot;  </span><br><span class="line">		:id&#x3D;&quot;index&quot;  </span><br><span class="line">        @play&#x3D;&quot;play(index)&quot;  </span><br><span class="line">        @loadedmetadata&#x3D;&quot;loadedmetadata&quot;  </span><br><span class="line">        controls  </span><br><span class="line">     &#x2F;&gt; </span><br><span class="line">&lt;&#x2F;view&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">data () &#123;  </span><br><span class="line">	return &#123;  </span><br><span class="line">		trailer: []  </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">methods: &#123;  </span><br><span class="line">        &#x2F;&#x2F;执行loadedmetadata 这个函数会显示你video里的信息 视频长度，大小，等等  </span><br><span class="line">        loadedmetadata(e) &#123;  </span><br><span class="line">            console.log(e)</span><br><span class="line">            &#x2F;&#x2F;获取所有视频的id,也就是在video里定义的id  </span><br><span class="line">            this.trailer.push(e.target.id)  </span><br><span class="line">        &#125;,  </span><br><span class="line">        play(index) &#123;  </span><br><span class="line">            &#x2F;&#x2F;循环一下得到的下标  </span><br><span class="line">            for (let i &#x3D; 0; i &lt; this.trailer.length; i  ) &#123;  </span><br><span class="line">                &#x2F;&#x2F;排除你播放的那个的下标  </span><br><span class="line">                if (i !&#x3D; index) &#123;  </span><br><span class="line">                    &#x2F;&#x2F;注意 这里的videoContext 第一个参数要是一个字符串  </span><br><span class="line">                    uni.createVideoContext(i.toString()).pause() &#x2F;&#x2F;执行暂停  </span><br><span class="line">                &#125;  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">        &#x2F;&#x2F; 如果没有下标的话 可以直接获取e 里面会带有你这个视频的id 获取e的时候 @play不要带参数  </span><br><span class="line">        &#x2F;&#x2F; play(e)&#123;  </span><br><span class="line">        &#x2F;&#x2F;  console.log(e)  </span><br><span class="line">        &#x2F;&#x2F;  let createid &#x3D; e.target.id  </span><br><span class="line">        &#x2F;&#x2F;      &#x2F;&#x2F;循环一下得到的下标  </span><br><span class="line">        &#x2F;&#x2F;      for (let i &#x3D; 0; i &lt; this.trailer.length; i++) &#123;  </span><br><span class="line">        &#x2F;&#x2F;          &#x2F;&#x2F;排除你播放的那个的下标  </span><br><span class="line">        &#x2F;&#x2F;          if (i !&#x3D; createid) &#123;  </span><br><span class="line">        &#x2F;&#x2F;              &#x2F;&#x2F;注意 这里的videoContext 第一个参数要是一个字符串  </span><br><span class="line">        &#x2F;&#x2F;              uni.createVideoContext(i.toString()).pause() &#x2F;&#x2F;执行暂停  </span><br><span class="line">        &#x2F;&#x2F;          &#125;</span><br><span class="line">        &#x2F;&#x2F;      &#125;</span><br><span class="line">        &#x2F;&#x2F; &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<hr>
<h4 id="9-uniApp-wx小程序API-人脸录入组件"><a href="#9-uniApp-wx小程序API-人脸录入组件" class="headerlink" title="9. uniApp + wx小程序API 人脸录入组件"></a>9. <font color="#00AAF0">uniApp + wx小程序API 人脸录入组件</font></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;view class&#x3D;&quot;modal bottom-modal&quot; :class&#x3D;&quot;show ? &#39;show&#39; : &#39;&#39;&quot;&gt;</span><br><span class="line">    &lt;view class&#x3D;&quot;dialog&quot; style&#x3D;&quot;border-radius: 8px 8px 0px 0px&quot;&gt;</span><br><span class="line">      &lt;view class&#x3D;&quot;bar bg-white&quot; style&#x3D;&quot;justify-content: flex-end&quot;&gt;</span><br><span class="line">        &lt;view class&#x3D;&quot;action text-blue&quot; @tap&#x3D;&quot;cameraError&quot;&gt;关闭&lt;&#x2F;view&gt;</span><br><span class="line">      &lt;&#x2F;view&gt;</span><br><span class="line">      &lt;view&gt;</span><br><span class="line">        &lt;view class&#x3D;&quot;detectInfo&quot;&gt;&#123;&#123; isSuccess ? &quot;人脸检测成功&quot; : tipsText &#125;&#125;&lt;&#x2F;view&gt;</span><br><span class="line">        &lt;view class&#x3D;&quot;faceContent&quot;&gt;</span><br><span class="line">          &lt;camera</span><br><span class="line">            v-if&#x3D;&quot;show &amp;&amp; !isSuccess&quot;</span><br><span class="line">            device-position&#x3D;&quot;front&quot;</span><br><span class="line">            resolution&#x3D;&quot;high&quot;</span><br><span class="line">            @stop&#x3D;&quot;cameraError&quot;</span><br><span class="line">            @error&#x3D;&quot;cameraError&quot;</span><br><span class="line">            class&#x3D;&quot;face-circle&quot;</span><br><span class="line">          &#x2F;&gt;</span><br><span class="line">          &lt;view class&#x3D;&quot;successImage&quot; v-if&#x3D;&quot;isSuccess&quot;&gt;</span><br><span class="line">            &lt;img src&#x3D;&quot;&#x2F;authSucceed.png&quot; &#x2F;&gt;</span><br><span class="line">          &lt;&#x2F;view&gt;</span><br><span class="line">        &lt;&#x2F;view&gt;</span><br><span class="line">      &lt;&#x2F;view&gt;</span><br><span class="line">    &lt;&#x2F;view&gt;</span><br><span class="line">  &lt;&#x2F;view&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">&#x2F;&#x2F; 人脸检测</span><br><span class="line">&#x2F;**</span><br><span class="line"> * @event &#123;Function&#125; photoChange 拍照完成事件</span><br><span class="line"> * @event &#123;Function&#125; detectFailed 人脸检测失败</span><br><span class="line"> * @event &#123;Function&#125; detectOver 人脸检测结束</span><br><span class="line"> *</span><br><span class="line"> * @method &#123;Function&#125; detectOver 人脸检测完成</span><br><span class="line"> * @method &#123;Function&#125; initData 初始化人脸检测</span><br><span class="line"> *&#x2F;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;face-detect&quot;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      show: false,</span><br><span class="line">      tipsText: &quot;检测不到人脸&quot;,</span><br><span class="line">      isSuccess: false, &#x2F;&#x2F;是否检测完成</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    &#x2F;&#x2F; 核验失败</span><br><span class="line">    cameraError(e) &#123;</span><br><span class="line">      this.hideModal()</span><br><span class="line">      this.$emit(&quot;detectFailed&quot;)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 关闭</span><br><span class="line">    hideModal() &#123;</span><br><span class="line">      wx.stopFaceDetect()</span><br><span class="line">      this.show &#x3D; false</span><br><span class="line">      this.tipsText &#x3D; &quot;检测不到人脸&quot;</span><br><span class="line">      this.isSuccess &#x3D; false</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 拍照</span><br><span class="line">    takePhoto() &#123;</span><br><span class="line">      const context &#x3D; uni.createCameraContext()</span><br><span class="line">      context.takePhoto(&#123;</span><br><span class="line">        quality: &quot;normal&quot;,</span><br><span class="line">        success: (res) &#x3D;&gt; &#123;</span><br><span class="line">          uni.getNetworkType(&#123;</span><br><span class="line">            success: (network) &#x3D;&gt; &#123;</span><br><span class="line">              if (network.networkType !&#x3D; &quot;none&quot;) &#123;</span><br><span class="line">                console.log(&#39;拍照返回值：&#39;, res)</span><br><span class="line">                console.log(&#39;图片路径：&#39;, res.tempImagePath)</span><br><span class="line">                &#x2F;&#x2F; 图片路径</span><br><span class="line">                this.detectOver(res.tempImagePath)</span><br><span class="line">              &#125; else &#123;</span><br><span class="line">                this.tipsText &#x3D; &quot;无网络，请确保网络为开启状态&quot;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            fail: (error) &#x3D;&gt; &#123;</span><br><span class="line">              this.tipsText &#x3D; &quot;当前网络异常，请稍后重试&quot;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 检测完成</span><br><span class="line">    detectOver(src) &#123;</span><br><span class="line">      this.isSuccess &#x3D; true</span><br><span class="line">      let t &#x3D; setTimeout(() &#x3D;&gt; &#123;</span><br><span class="line">        &#x2F;&#x2F; this.hideModal()</span><br><span class="line">        clearTimeout(t)</span><br><span class="line">        &#x2F;&#x2F; this.$emit(&quot;detectOver&quot;)</span><br><span class="line">        console.log(&#39;完成人脸录入，response value&#39;)</span><br><span class="line">        this.$emit(&quot;photo&quot;, src)</span><br><span class="line">      &#125;, 2000)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    initData() &#123;</span><br><span class="line">      wx.getSetting(&#123;</span><br><span class="line">        success: (res) &#x3D;&gt; &#123;</span><br><span class="line">          if (res.authSetting[&quot;scope.camera&quot;]) &#123;</span><br><span class="line">            this.faceDetect()</span><br><span class="line">          &#125; else &#123;</span><br><span class="line">            wx.authorize(&#123;</span><br><span class="line">              scope: &quot;scope.camera&quot;,</span><br><span class="line">              success: () &#x3D;&gt; &#123;</span><br><span class="line">                this.faceDetect()</span><br><span class="line">              &#125;,</span><br><span class="line">              fail: (error) &#x3D;&gt; &#123;</span><br><span class="line">                wx.showToast(&#123; title: &quot;授权失败&quot;, icon: &quot;none&quot; &#125;)</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        fail: (error) &#x3D;&gt; &#123;</span><br><span class="line">          wx.showToast(&#123; title: &quot;获取用户授权信息失败&quot;, icon: &quot;none&quot; &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 初始化人脸检测</span><br><span class="line">    faceDetect() &#123;</span><br><span class="line">      this.show &#x3D; true</span><br><span class="line">      wx.initFaceDetect()</span><br><span class="line">      const context &#x3D; wx.createCameraContext()</span><br><span class="line">      const listener &#x3D; context.onCameraFrame((frame) &#x3D;&gt; &#123;</span><br><span class="line">        wx.faceDetect(&#123;</span><br><span class="line">          frameBuffer: frame.data,</span><br><span class="line">          width: frame.width,</span><br><span class="line">          height: frame.height,</span><br><span class="line">          enablePoint: true,</span><br><span class="line">          enableConf: true,</span><br><span class="line">          enableAngle: true,</span><br><span class="line">          enableMultiFace: true,</span><br><span class="line">          success: (faceData) &#x3D;&gt; &#123;</span><br><span class="line">            console.log(&#39;识别到的人脸数据faceData:&#39;, faceData)</span><br><span class="line">            let face &#x3D; faceData.faceInfo[0]</span><br><span class="line">            if (faceData.x &#x3D;&#x3D; -1 || faceData.y &#x3D;&#x3D; -1) &#123;</span><br><span class="line">              this.tipsText &#x3D; &quot;检测不到人脸&quot;</span><br><span class="line">            &#125;</span><br><span class="line">            if (faceData.faceInfo.length &gt; 1) &#123;</span><br><span class="line">              this.tipsText &#x3D; &quot;请保证相框内只有一人&quot;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">              if (</span><br><span class="line">                face.angleArray.pitch &gt;&#x3D; 0.2 ||</span><br><span class="line">                face.angleArray.roll &gt;&#x3D; 0.2 ||</span><br><span class="line">                face.angleArray.yaw &gt;&#x3D; 0.2</span><br><span class="line">              ) &#123;</span><br><span class="line">                this.tipsText &#x3D; &quot;请平视摄像头&quot;</span><br><span class="line">              &#125; else if (</span><br><span class="line">                face.confArray.global &lt;&#x3D; 0.7 ||</span><br><span class="line">                face.confArray.leftEye &lt;&#x3D; 0.7 ||</span><br><span class="line">                face.confArray.mouth &lt;&#x3D; 0.7 ||</span><br><span class="line">                face.confArray.nose &lt;&#x3D; 0.7 ||</span><br><span class="line">                face.confArray.rightEye &lt;&#x3D; 0.7</span><br><span class="line">              ) &#123;</span><br><span class="line">                this.tipsText &#x3D; &quot;请勿遮挡五官&quot;</span><br><span class="line">              &#125; else &#123;</span><br><span class="line">                this.tipsText &#x3D; &quot;正在核验，请保持&quot;</span><br><span class="line">                this.takePhoto()</span><br><span class="line">                wx.stopFaceDetect()</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          fail: (err) &#x3D;&gt; &#123;</span><br><span class="line">            console.log(&#39;人脸faceDetect error:&#39;, err)</span><br><span class="line">            if (err.x &#x3D;&#x3D; -1 || err.y &#x3D;&#x3D; -1) &#123;</span><br><span class="line">              this.tipsText &#x3D; &quot;检测不到人脸&quot;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">      listener.start()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang&#x3D;&quot;less&quot; scoped&gt;</span><br><span class="line">.modal &#123;</span><br><span class="line">  position: fixed;</span><br><span class="line">  top: 0;</span><br><span class="line">  right: 0;</span><br><span class="line">  bottom: 0;</span><br><span class="line">  left: 0;</span><br><span class="line">  z-index: 1110;</span><br><span class="line">  opacity: 0;</span><br><span class="line">  outline: 0;</span><br><span class="line">  text-align: center;</span><br><span class="line">  -ms-transform: scale(1.185);</span><br><span class="line">  transform: scale(1.185);</span><br><span class="line">  backface-visibility: hidden;</span><br><span class="line">  perspective: 2000rpx;</span><br><span class="line">  background: rgba(0, 0, 0, 0.6);</span><br><span class="line">  transition: all 0.3s ease-in-out 0s;</span><br><span class="line">  pointer-events: none;</span><br><span class="line">&#125;</span><br><span class="line">.modal::before &#123;</span><br><span class="line">  content: &quot;\200B&quot;;</span><br><span class="line">  display: inline-block;</span><br><span class="line">  height: 100%;</span><br><span class="line">  vertical-align: middle;</span><br><span class="line">&#125;</span><br><span class="line">.modal.show &#123;</span><br><span class="line">  opacity: 1;</span><br><span class="line">  transition-duration: 0.3s;</span><br><span class="line">  -ms-transform: scale(1);</span><br><span class="line">  transform: scale(1);</span><br><span class="line">  overflow-x: hidden;</span><br><span class="line">  overflow-y: auto;</span><br><span class="line">  pointer-events: auto;</span><br><span class="line">&#125;</span><br><span class="line">.modal.bottom-modal::before &#123;</span><br><span class="line">  vertical-align: bottom;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.modal.bottom-modal .dialog &#123;</span><br><span class="line">  width: 100%;</span><br><span class="line">  border-radius: 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.modal.bottom-modal &#123;</span><br><span class="line">  margin-bottom: -1000rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.modal.bottom-modal.show &#123;</span><br><span class="line">  margin-bottom: 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.dialog &#123;</span><br><span class="line">  position: relative;</span><br><span class="line">  display: inline-block;</span><br><span class="line">  vertical-align: middle;</span><br><span class="line">  margin-left: auto;</span><br><span class="line">  margin-right: auto;</span><br><span class="line">  width: 680rpx;</span><br><span class="line">  height: 90%;</span><br><span class="line">  max-width: 100%;</span><br><span class="line">  background-color: #f8f8f8;</span><br><span class="line">  border-radius: 10rpx;</span><br><span class="line">  overflow: hidden;</span><br><span class="line">&#125;</span><br><span class="line">.bar &#123;</span><br><span class="line">  display: flex;</span><br><span class="line">  position: relative;</span><br><span class="line">  align-items: center;</span><br><span class="line">  min-height: 100rpx;</span><br><span class="line">  padding: 0rpx 40rpx;</span><br><span class="line">  justify-content: space-between;</span><br><span class="line">&#125;</span><br><span class="line">.bg-white &#123;</span><br><span class="line">  background-color: #ffffff;</span><br><span class="line">  color: #666666;</span><br><span class="line">&#125;</span><br><span class="line">.action &#123;</span><br><span class="line">  color: #0081ff;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">image &#123;</span><br><span class="line">  width: 100%;</span><br><span class="line">  height: 100%;</span><br><span class="line">&#125;</span><br><span class="line">.detectInfo &#123;</span><br><span class="line">  padding: 100rpx 0rpx;</span><br><span class="line">  font-size: 34rpx;</span><br><span class="line">  text-align: center;</span><br><span class="line">&#125;</span><br><span class="line">.faceContent &#123;</span><br><span class="line">  height: 700rpx;</span><br><span class="line">  position: relative;</span><br><span class="line">  .face-circle &#123;</span><br><span class="line">    width: 600rpx;</span><br><span class="line">    height: 600rpx;</span><br><span class="line">    border-radius: 50%;</span><br><span class="line">    position: absolute;</span><br><span class="line">    top: 0;</span><br><span class="line">    left: 50%;</span><br><span class="line">    transform: translateX(-50%);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">.faceContent</span><br><span class="line">.successImage &#123;</span><br><span class="line">  overflow: hidden;</span><br><span class="line">  width: 600rpx;</span><br><span class="line">  height: 600rpx;</span><br><span class="line">  border-radius: 50%;</span><br><span class="line">  position: absolute;</span><br><span class="line">  top: 0;</span><br><span class="line">  left: 50%;</span><br><span class="line">  transform: translateX(-50%);</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="10-解决Uniapp-Map-APP端-show-location-不显示的问题"><a href="#10-解决Uniapp-Map-APP端-show-location-不显示的问题" class="headerlink" title="10. 解决Uniapp Map APP端 show-location 不显示的问题"></a>10. <font color="#00AAF0">解决Uniapp Map APP端 <code>show-location</code> 不显示的问题</font></h4><p><font color="red">注：</font> 不想看下面废话的可以直接看最后一句和code。</p>
<p>最近在做APP Map的时候虽然在Map中定义了 <code>show-location</code> 属性，但在真机上运行还是无法渲染出来，翻看了许多百度的文章最终在一篇 <a href="https://ask.dcloud.net.cn/question/75036" target="_blank" rel="noopener">DCLOUD社区文章</a> 评论区一位大佬给了提示：</p>
<p><img src="C:%5CUsers%5Cz%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20220804000554271.png" alt="image-20220804000554271"></p>
<p>我也以这种方式测试了一下，但结果是失望的。最终自己在uniapp API 官网查看Map方法时注意到了 <code>updated</code> 这个方法，想到了是不是Map没有渲染完成的问题。于是试了 <code>$forceUpdate()</code> 和延时操作，我的结果是 <code>setTimeout</code> 延时操作是可以的。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// template view</span></span><br><span class="line">&lt;map</span><br><span class="line">    id=<span class="string">"mapId"</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span></span>=<span class="string">"map"</span></span><br><span class="line">    :show-location=<span class="string">"true"</span></span><br><span class="line">    :latitude=<span class="string">"latitude"</span></span><br><span class="line">    :longitude=<span class="string">"longitude"</span></span><br><span class="line">    :markers=<span class="string">"markers"</span></span><br><span class="line">    @tap=<span class="string">"mapClick"</span></span><br><span class="line">    @regionchange=<span class="string">"regionchange"</span></span><br><span class="line">    :scale=<span class="string">"15"</span></span><br><span class="line">/&gt;</span><br><span class="line">        </span><br><span class="line"><span class="comment">// script</span></span><br><span class="line">data() &#123;</span><br><span class="line">        <span class="keyword">return</span>&#123; </span><br><span class="line">            selectIndex: <span class="literal">undefined</span>,</span><br><span class="line">            selectAddr: &#123;&#125;,</span><br><span class="line">            searchWords: <span class="string">""</span>,</span><br><span class="line">            id: <span class="number">0</span>, <span class="comment">// 使用 marker点击事件 需要填写 id</span></span><br><span class="line">            title: <span class="string">'map'</span>,</span><br><span class="line">            latitude: <span class="number">39.909</span>,</span><br><span class="line">            longitude: <span class="number">116.39742</span>,</span><br><span class="line">            markers: [</span><br><span class="line">                &#123;</span><br><span class="line">                    id: <span class="number">0</span>,</span><br><span class="line">                    latitude: <span class="number">39.909</span>,</span><br><span class="line">                    longitude: <span class="number">116.39742</span>,</span><br><span class="line">                    width: <span class="number">30</span>,</span><br><span class="line">                    height: <span class="number">30</span>,</span><br><span class="line">                    iconPath: <span class="string">'/static/home/icon_marker.png'</span>,</span><br><span class="line">                    alpha: <span class="number">0.7</span>,</span><br><span class="line">                    callout: &#123;&#125;,</span><br><span class="line">                    label: &#123;&#125;</span><br><span class="line">                &#125;</span><br><span class="line">            ],</span><br><span class="line">            callout: &#123;</span><br><span class="line">                display: <span class="string">'ALWAYS'</span>,</span><br><span class="line">                content: <span class="string">''</span>,</span><br><span class="line">                borderRadius: <span class="number">6</span>,</span><br><span class="line">                padding: <span class="number">7</span>,</span><br><span class="line">                fontSize: <span class="number">12</span>,</span><br><span class="line">                color: <span class="string">'#fff'</span>,</span><br><span class="line">                bgColor: <span class="string">'#397BE2'</span>,</span><br><span class="line">                textAlign: <span class="string">'center'</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// Map上的图标</span></span><br><span class="line">            <span class="comment">// controls: [&#123;</span></span><br><span class="line">            <span class="comment">//   id: 1,</span></span><br><span class="line">            <span class="comment">//   iconPath: '/static/home/icon_marker.png',</span></span><br><span class="line">            <span class="comment">//   position: &#123;</span></span><br><span class="line">            <span class="comment">//     left: 100,</span></span><br><span class="line">            <span class="comment">// 		top: 100,</span></span><br><span class="line">            <span class="comment">// 		width: 30,</span></span><br><span class="line">            <span class="comment">// 		height: 30</span></span><br><span class="line">            <span class="comment">//   &#125;</span></span><br><span class="line">            <span class="comment">// &#125;],</span></span><br><span class="line">            dataTips: [],</span><br><span class="line">            mapContext: <span class="literal">null</span>,</span><br><span class="line">            <span class="comment">// #ifdef APP-PLUS</span></span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 用来区分是搜索 select 移动的 marker 还是手动移动 map 移动的 marker</span></span><br><span class="line"><span class="comment">         * 搜索 select 移动 getAddressFormat() 不执行</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">            isManual: <span class="literal">true</span>,</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 区分使用 APP 手机系统是 ios 还是 android</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">            systemType: <span class="string">''</span></span><br><span class="line">            <span class="comment">// #endif</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 生命周期</span></span><br><span class="line">onShow() &#123;</span><br><span class="line">    <span class="comment">// 创建Map上下文</span></span><br><span class="line">    <span class="keyword">this</span>.mapContext = uni.createMapContext(<span class="string">"mapId"</span>, <span class="keyword">this</span>)</span><br><span class="line">    <span class="comment">// #ifdef APP-PLUS</span></span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.mapContext.$getAppMap().showUserLocation(<span class="literal">true</span>)</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'设置showUserLocation:'</span>, <span class="keyword">this</span>.mapContext.$getAppMap())</span><br><span class="line">    &#125;, <span class="number">300</span>)</span><br><span class="line">    <span class="comment">// #endif</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="11-Uniapp-APP端点击事件失效问题"><a href="#11-Uniapp-APP端点击事件失效问题" class="headerlink" title="11. Uniapp APP端点击事件失效问题"></a>11. <font color="#00AAF0">Uniapp APP端点击事件失效问题</font></h4><p>(1) 在微信点击按钮没有反映</p>
<p>微信ios内置浏览器认为，不是button a标签之外的非点击元素 比如div 是不可点击的</p>
<p>比如给div绑了click事件，在微信里边是不生效的，解决办法是给这个div元素添加一个样式属性 cursor: pointer;</p>
<p>(2) 弹框中某个区域内内容很多，我们希望使用overflow：scroll；</p>
<p>当超过之后，可以滚动查看，但是如果这样的话，在移动端是有问题的，比如滑动卡顿，ios手机滑动时划不动的情况。  有会有不少人使用IScroll.js  这个插件。</p>
<p>那么在IScroll控制的区域中，如果有元素需要被点击，那绑定的click事件也是不生效的，解决办法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">myScroll = <span class="keyword">new</span> IScroll(<span class="string">"#wrapper"</span>, &#123;</span><br><span class="line">    scrollbars: <span class="literal">true</span>,</span><br><span class="line">    mouseWheel: <span class="literal">false</span>,</span><br><span class="line">    interactiveScrollbars: <span class="literal">true</span>,</span><br><span class="line">    shrinkScrollbars: <span class="string">'scale'</span>,</span><br><span class="line">    fadeScrollbars: <span class="literal">true</span>,</span><br><span class="line">    scrollY: <span class="literal">true</span>,</span><br><span class="line">    probeType: <span class="number">2</span>,</span><br><span class="line">    bindToWrapper: <span class="literal">true</span>,</span><br><span class="line">    click: <span class="literal">true</span>,</span><br><span class="line">    taps:<span class="literal">true</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>在new的时候 传入第二个参数，是一个对象，其中的click taps都要设置成true，这里边这些参数有一些是不需要的，比如有的是展示移动端滑动条啥的，按需删除就行了。</p>
<hr>
<h4 id="12-uniapp开发常见移动端IOS兼容性问题"><a href="#12-uniapp开发常见移动端IOS兼容性问题" class="headerlink" title="12. uniapp开发常见移动端IOS兼容性问题"></a>12. <font color="#00AAF0">uniapp开发常见移动端IOS兼容性问题</font></h4><hr>
<p>1: <strong>uni-app 页面上下滑动回弹效果关闭</strong><br>当页面中没有使用scrolll-view,但是有上下+左右滑动的时候，在ios上会出现回弹<br>解决方式：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"path"</span>: <span class="string">"pages/home/map/index"</span>,</span><br><span class="line">        <span class="string">"style"</span>: &#123;</span><br><span class="line">            <span class="string">"navigationStyle"</span>: <span class="string">"custom"</span>,</span><br><span class="line">            <span class="string">"disableScroll"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="string">"enablePullDownRefresh"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"navigationBarBackgroundColor"</span>: <span class="string">"#FFF"</span>,</span><br><span class="line">            <span class="string">"app-plus"</span>: &#123;</span><br><span class="line">                <span class="string">"animationType"</span>: <span class="string">"fade-in"</span>,</span><br><span class="line">                <span class="string">"animationDuration"</span>: <span class="number">300</span>,</span><br><span class="line">                <span class="string">"bounce"</span>: <span class="string">"none"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><img src="https://img-blog.csdnimg.cn/0f0af2a6a61240179f60db7f7a5259b7.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU3R1ZHkxMjN3Zg==,size_17,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p>
<p><strong>2: uview的时间格式在ios页面只支持”/“不支持”-“</strong></p>
<p><strong>3: IOS 15 input 的 confirm-type=“search” 时，会自带搜索图标，并且图标会挡住 placeholder 的内容</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// IOS 15 input 的 confirm-type="search" 时，会自带搜索图标，并且图标会挡住 placeholder 的内容</span></span><br><span class="line">[type=<span class="string">"search"</span>]::-webkit-search-decoration &#123;</span><br><span class="line">    display: none;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="13-移动端使用高德地图api调取地图并实现搜索地点的功能组件"><a href="#13-移动端使用高德地图api调取地图并实现搜索地点的功能组件" class="headerlink" title="13. 移动端使用高德地图api调取地图并实现搜索地点的功能组件"></a>13. <font color="#00AAF0">移动端使用高德地图api调取地图并实现搜索地点的功能组件</font></h4><hr>
<p>该组件仅仅为了完成功能和自己的需求，可持续优化。兼容IOS和Android</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;view <span class="class"><span class="keyword">class</span></span>=<span class="string">"content"</span>&gt;</span><br><span class="line">    &lt;!-- 选取地点后的确定和取消按钮 --&gt;</span><br><span class="line">    &lt;!-- #ifdef MP-WEIXIN || H5 --&gt;</span><br><span class="line">    &lt;view <span class="class"><span class="keyword">class</span></span>=<span class="string">"btns"</span>&gt;</span><br><span class="line">      &lt;!-- <span class="xml"><span class="tag">&lt;<span class="name">view</span> @<span class="attr">click</span>=<span class="string">"back"</span>&gt;</span>取消<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line">      &lt;view @click=<span class="string">"checkAdd"</span>&gt;确定&lt;<span class="regexp">/view&gt; --&gt;</span></span><br><span class="line"><span class="regexp">      &lt;van-icon name="arrow-left" size="48rpx" @tap="back" class="btns-icon" /</span>&gt;</span><br><span class="line">    &lt;<span class="regexp">/view&gt;</span></span><br><span class="line"><span class="regexp">    &lt;!-- #endif --&gt;</span></span><br><span class="line"><span class="regexp">    &lt;!-- #ifdef APP-PLUS  --&gt;</span></span><br><span class="line"><span class="regexp">    &lt;uni-status-bar /</span>&gt;</span><br><span class="line">    &lt;uni-nav-bar</span><br><span class="line">      title=<span class="string">"更新服务地址"</span></span><br><span class="line">      :fixed=<span class="string">"true"</span></span><br><span class="line">      leftIcon=<span class="string">"arrowleft"</span></span><br><span class="line">      @clickLeft=<span class="string">"back"</span></span><br><span class="line">    /&gt;</span><br><span class="line">    &lt;!-- #endif --&gt;</span><br><span class="line">    &lt;!-- 地图部分 --&gt;</span><br><span class="line">    &lt;map</span><br><span class="line">      id=<span class="string">"mapId"</span></span><br><span class="line">      <span class="class"><span class="keyword">class</span></span>=<span class="string">"map"</span></span><br><span class="line">      :show-location=<span class="string">"true"</span></span><br><span class="line">      :latitude=<span class="string">"latitude"</span></span><br><span class="line">      :longitude=<span class="string">"longitude"</span></span><br><span class="line">      :markers=<span class="string">"markers"</span></span><br><span class="line">      @tap=<span class="string">"mapClick"</span></span><br><span class="line">      @regionchange=<span class="string">"regionchange"</span></span><br><span class="line">      :scale=<span class="string">"15"</span></span><br><span class="line">    /&gt;</span><br><span class="line">    &lt;!-- 搜索框 --&gt;</span><br><span class="line">    &lt;view <span class="class"><span class="keyword">class</span></span>=<span class="string">"inputCon"</span>&gt;</span><br><span class="line">      &lt;view <span class="class"><span class="keyword">class</span></span>=<span class="string">"searchView"</span>&gt;</span><br><span class="line">        &lt;view <span class="class"><span class="keyword">class</span></span>=<span class="string">"iconfont icon-sousuo"</span>&gt;</span><br><span class="line">          &lt;van-icon name=<span class="string">"search"</span> size=<span class="string">"30rpx"</span> /&gt;</span><br><span class="line">        &lt;<span class="regexp">/view&gt;</span></span><br><span class="line"><span class="regexp">        &lt;input type="text" placeholder="请输入搜索地址" v-model="searchWords" @input="searchFn" confirm-type="搜索" @confirm="searchFn" /</span>&gt;</span><br><span class="line">        &lt;text <span class="class"><span class="keyword">class</span></span>=<span class="string">"cancel"</span> @click=<span class="string">"cancel"</span>&gt;取消&lt;<span class="regexp">/text&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>view&gt;</span><br><span class="line">      &lt;view <span class="class"><span class="keyword">class</span></span>=<span class="string">"operate"</span>&gt;</span><br><span class="line">        &lt;text @click=<span class="string">"checkAdd"</span>&gt;确定&lt;<span class="regexp">/text&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>view&gt;</span><br><span class="line">    &lt;<span class="regexp">/view&gt;</span></span><br><span class="line"><span class="regexp">    &lt;!-- 地点列表部分 --&gt;</span></span><br><span class="line"><span class="regexp">    &lt;!-- #ifdef MP-WEIXIN || H5 --&gt;</span></span><br><span class="line"><span class="regexp">    &lt;view class="list"&gt;</span></span><br><span class="line"><span class="regexp">    &lt;!-- #endif --&gt;</span></span><br><span class="line"><span class="regexp">    &lt;!-- #ifdef APP-PLUS --&gt;</span></span><br><span class="line"><span class="regexp">    &lt;view class="list" :style="&#123; height: systemType === 'android' ? '39vh' : '54vh' &#125;"&gt;</span></span><br><span class="line"><span class="regexp">      &lt;scroll-view scroll-y style="height: 45vh;"&gt;</span></span><br><span class="line"><span class="regexp">    &lt;!-- #endif --&gt;</span></span><br><span class="line"><span class="regexp">        &lt;view</span></span><br><span class="line"><span class="regexp">          class="item"</span></span><br><span class="line"><span class="regexp">          :class="selectIndex == index ? 'active' : '' "</span></span><br><span class="line"><span class="regexp">          v-for="(item, index) in dataTips"</span></span><br><span class="line"><span class="regexp">          :key="item.id"</span></span><br><span class="line"><span class="regexp">          @click="select(item, index)"</span></span><br><span class="line"><span class="regexp">        &gt;</span></span><br><span class="line"><span class="regexp">          &lt;view class="name"&gt;&#123;&#123; item.name &#125;&#125;&lt;/</span>view&gt;</span><br><span class="line">          &lt;view <span class="class"><span class="keyword">class</span></span>=<span class="string">"address"</span>&gt;</span><br><span class="line">            &lt;text&gt;&#123;&#123; item.district || <span class="string">''</span> &#125;&#125;&#123;&#123; item.address || <span class="string">''</span> &#125;&#125;&lt;<span class="regexp">/text&gt;</span></span><br><span class="line"><span class="regexp">            &lt;!-- distance 为当前坐标离中心点的距离 --&gt;</span></span><br><span class="line"><span class="regexp">            &lt;!-- &lt;text&gt;&#123;&#123; item.distance ? item.distance + 'm' : '' &#125;&#125;&lt;/</span>text&gt; --&gt;</span><br><span class="line">          &lt;<span class="regexp">/view&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>view&gt;</span><br><span class="line">      &lt;!-- #ifdef APP-PLUS --&gt;</span><br><span class="line">        &lt;!-- 占位符，请勿删除 --&gt;</span><br><span class="line">        &lt;view style=<span class="string">"height: 10vh;"</span> /&gt;</span><br><span class="line">      &lt;<span class="regexp">/scroll-view&gt;</span></span><br><span class="line"><span class="regexp">      &lt;!-- #endif --&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>view&gt;</span><br><span class="line">  &lt;<span class="regexp">/view&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="comment">// 引入高德地图api提供的微信小程序的接口</span></span><br><span class="line">  <span class="keyword">var</span> amapFile = <span class="built_in">require</span>(<span class="string">'@/common/amap-wx.130.js'</span>) <span class="comment">// 如：..­/..­/libs/amap-wx.js</span></span><br><span class="line">  <span class="comment">// 创建地图</span></span><br><span class="line">  <span class="keyword">var</span> myAmapFun = <span class="keyword">new</span> amapFile.AMapWX(&#123; <span class="attr">key</span>: <span class="string">'194d55fc09d92d9047bd16803ce06b7b'</span> &#125;)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"创建了高德地图"</span>)</span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    data() &#123;</span><br><span class="line">      <span class="keyword">return</span>&#123; </span><br><span class="line">        selectIndex: <span class="literal">undefined</span>,</span><br><span class="line">        selectAddr: &#123;&#125;,</span><br><span class="line">        searchWords: <span class="string">""</span>,</span><br><span class="line">        id: <span class="number">0</span>, <span class="comment">// 使用 marker点击事件 需要填写 id</span></span><br><span class="line">        title: <span class="string">'map'</span>,</span><br><span class="line">        latitude: <span class="number">39.909</span>,</span><br><span class="line">        longitude: <span class="number">116.39742</span>,</span><br><span class="line">        markers: [</span><br><span class="line">          &#123;</span><br><span class="line">            id: <span class="number">0</span>,</span><br><span class="line">            latitude: <span class="number">39.909</span>,</span><br><span class="line">            longitude: <span class="number">116.39742</span>,</span><br><span class="line">            width: <span class="number">30</span>,</span><br><span class="line">            height: <span class="number">30</span>,</span><br><span class="line">            iconPath: <span class="string">'/static/home/icon_marker.png'</span>,</span><br><span class="line">            alpha: <span class="number">0.7</span>,</span><br><span class="line">            callout: &#123;&#125;,</span><br><span class="line">            label: &#123;&#125;</span><br><span class="line">          &#125;</span><br><span class="line">        ],</span><br><span class="line">        callout: &#123;</span><br><span class="line">          display: <span class="string">'ALWAYS'</span>,</span><br><span class="line">          content: <span class="string">''</span>,</span><br><span class="line">          borderRadius: <span class="number">6</span>,</span><br><span class="line">          padding: <span class="number">7</span>,</span><br><span class="line">          fontSize: <span class="number">12</span>,</span><br><span class="line">          color: <span class="string">'#fff'</span>,</span><br><span class="line">          bgColor: <span class="string">'#397BE2'</span>,</span><br><span class="line">          textAlign: <span class="string">'center'</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// Map上的图标</span></span><br><span class="line">        <span class="comment">// controls: [&#123;</span></span><br><span class="line">        <span class="comment">//   id: 1,</span></span><br><span class="line">        <span class="comment">//   iconPath: '/static/home/icon_marker.png',</span></span><br><span class="line">        <span class="comment">//   position: &#123;</span></span><br><span class="line">        <span class="comment">//     left: 100,</span></span><br><span class="line">				<span class="comment">// 		top: 100,</span></span><br><span class="line">				<span class="comment">// 		width: 30,</span></span><br><span class="line">				<span class="comment">// 		height: 30</span></span><br><span class="line">        <span class="comment">//   &#125;</span></span><br><span class="line">        <span class="comment">// &#125;],</span></span><br><span class="line">        dataTips: [],</span><br><span class="line">        mapContext: <span class="literal">null</span>,</span><br><span class="line">        <span class="comment">// #ifdef APP-PLUS</span></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 用来区分是搜索 select 移动的 marker 还是手动移动 map 移动的 marker</span></span><br><span class="line"><span class="comment">         * 搜索 select 移动 getAddressFormat() 不执行</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        isManual: <span class="literal">true</span>,</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 区分使用 APP 手机系统是 ios 还是 android</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        systemType: <span class="string">''</span></span><br><span class="line">        <span class="comment">// #endif</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    onLoad(options) &#123;</span><br><span class="line">      <span class="comment">// #ifdef APP-PLUS</span></span><br><span class="line">      <span class="keyword">this</span>.systemCompatible()</span><br><span class="line">      <span class="comment">// #endif</span></span><br><span class="line"></span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'map-search onload:'</span>, options)</span><br><span class="line">      <span class="keyword">if</span>(options &amp;&amp; options.lng) &#123;</span><br><span class="line">        <span class="keyword">this</span>.longitude = options.lng</span><br><span class="line">        <span class="keyword">this</span>.markers[<span class="number">0</span>].longitude = <span class="keyword">this</span>.longitude</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span>(options &amp;&amp; options.lat) &#123;</span><br><span class="line">        <span class="keyword">this</span>.latitude = options.lat</span><br><span class="line">        <span class="keyword">this</span>.markers[<span class="number">0</span>].latitude = <span class="keyword">this</span>.latitude</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 获取当前位置的地点列表</span></span><br><span class="line">      myAmapFun.getPoiAround(&#123;</span><br><span class="line">        success: <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">"获取当前的列表"</span>, data)</span><br><span class="line">          <span class="keyword">this</span>.dataTips = data.poisData</span><br><span class="line">        &#125;,</span><br><span class="line">        fail: <span class="function">(<span class="params">info</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(info)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">this</span>.mapContext = uni.createMapContext(<span class="string">"mapId"</span>, <span class="keyword">this</span>)</span><br><span class="line">      <span class="keyword">this</span>.reserGeo()</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'onLoad最终的markers'</span>, <span class="keyword">this</span>.markers)</span><br><span class="line">    &#125;,</span><br><span class="line">    onShow() &#123;</span><br><span class="line">      <span class="comment">// #ifdef APP-PLUS</span></span><br><span class="line">      setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.mapContext.$getAppMap().showUserLocation(<span class="literal">true</span>)</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'设置showUserLocation:'</span>, <span class="keyword">this</span>.mapContext.$getAppMap())</span><br><span class="line">      &#125;, <span class="number">300</span>)</span><br><span class="line">      <span class="comment">// #endif</span></span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      <span class="comment">// 选择地点后，将选取的地点传递到前一个页面中</span></span><br><span class="line">      checkAdd() &#123;</span><br><span class="line">        uni.showModal(&#123;</span><br><span class="line">          content: <span class="string">'更新服务地址，将同步更新老人的家庭地址。更新后，每次扫码下单都使用更新后的家庭地址，且每月更新次数有限。是否确认更新老人家庭住址?'</span>,</span><br><span class="line">          showCancel: <span class="literal">true</span>,</span><br><span class="line">          success: <span class="function">(<span class="params">&#123; confirm &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (confirm) &#123;</span><br><span class="line">              <span class="keyword">if</span> (<span class="built_in">Object</span>.keys(<span class="keyword">this</span>.selectAddr).length) &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">'确定选择 this.markers'</span>, <span class="keyword">this</span>.markers)</span><br><span class="line">                <span class="comment">// uni.setStorageSync('address', this.markers[0])</span></span><br><span class="line">                <span class="keyword">let</span> pages = getCurrentPages() <span class="comment">// 获取所有的页面栈</span></span><br><span class="line">                <span class="keyword">let</span> prevPage = pages[pages.length - <span class="number">2</span>]  <span class="comment">// 找到上一个页面，注意是页面，如果是页面中有组件，则需要通过页面接受到数据后，再次往组件中传递</span></span><br><span class="line">                prevPage.$vm.addressObj = <span class="keyword">this</span>.selectAddr <span class="comment">//在上一个页面中就可以用addressObj进行接收</span></span><br><span class="line">                uni.navigateBack()</span><br><span class="line">                <span class="keyword">this</span>.getOpenerEventChannel().emit(<span class="string">'onBackPress'</span>, <span class="keyword">this</span>.selectAddr)</span><br><span class="line">              &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                uni.showToast(&#123;</span><br><span class="line">                  title: <span class="string">'请至少选择一个地址'</span>,</span><br><span class="line">                  icon: <span class="string">'none'</span></span><br><span class="line">                &#125;)</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">      back() &#123;</span><br><span class="line">        <span class="keyword">this</span>.$emit(<span class="string">'back'</span>)</span><br><span class="line">        uni.navigateBack()</span><br><span class="line">      &#125;,</span><br><span class="line">      cancel() &#123; </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>.searchWords) &#123; </span><br><span class="line">          <span class="keyword">this</span>.searchWords = <span class="string">""</span></span><br><span class="line">          myAmapFun.getPoiAround(&#123; </span><br><span class="line">            location: <span class="keyword">this</span>.markers[<span class="number">0</span>].longitude+<span class="string">','</span>+<span class="keyword">this</span>.markers[<span class="number">0</span>].latitude,</span><br><span class="line">            success: <span class="function">(<span class="params">data</span>) =&gt;</span> &#123; </span><br><span class="line">              <span class="built_in">console</span>.log(<span class="string">"获取当前的列表"</span>, data)</span><br><span class="line">              <span class="keyword">this</span>.dataTips = data.poisData</span><br><span class="line">            &#125;,</span><br><span class="line">            fail: <span class="function">(<span class="params">info</span>) =&gt;</span> &#123; </span><br><span class="line">              <span class="built_in">console</span>.log(info)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      reserGeo() &#123;</span><br><span class="line">        myAmapFun.getRegeo(&#123;</span><br><span class="line">          success: <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.$emit(<span class="string">'reserGeo'</span>, data)</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"获取当前定位信息"</span>, data)</span><br><span class="line">            <span class="keyword">this</span>.selectAddr = &#123;</span><br><span class="line">              address: data[<span class="number">0</span>].regeocodeData.formatted_address,</span><br><span class="line">              longitude: data[<span class="number">0</span>].longitude,</span><br><span class="line">              latitude: data[<span class="number">0</span>].latitude,</span><br><span class="line">              provice: data[<span class="number">0</span>].regeocodeData.addressComponent.province || <span class="string">''</span>,</span><br><span class="line">              city: data[<span class="number">0</span>].regeocodeData.addressComponent.city || <span class="string">''</span>,</span><br><span class="line">              district: data[<span class="number">0</span>].regeocodeData.addressComponent.district || <span class="string">''</span>,</span><br><span class="line">              street: data[<span class="number">0</span>].regeocodeData.addressComponent.township || <span class="string">''</span>,</span><br><span class="line">              addressDetail: data[<span class="number">0</span>].desc || <span class="string">''</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          fail: <span class="function">(<span class="params">info</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(info)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// 根据地址列表中选择某一个地点</span></span><br><span class="line">      select(item, index) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'根据地址列表中选择某一个地点select item'</span>, item)</span><br><span class="line">        <span class="keyword">if</span>(!item) &#123;</span><br><span class="line">          <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.selectIndex = index</span><br><span class="line">        <span class="keyword">var</span> location = item.location.split(<span class="string">","</span>)</span><br><span class="line">        <span class="built_in">console</span>.log(location)</span><br><span class="line">        <span class="keyword">this</span>.selectAddr = item.pname ? &#123;</span><br><span class="line">          address: item.pname+item.cityname+item.adname+item.address,</span><br><span class="line">          longitude: location[<span class="number">0</span>],</span><br><span class="line">          latitude: location[<span class="number">1</span>],</span><br><span class="line">          provice: item?.pname || <span class="string">''</span>,</span><br><span class="line">          city: item?.cityname || <span class="string">''</span>,</span><br><span class="line">          area: item?.adname || <span class="string">''</span>,</span><br><span class="line">          addressDetail: item?.address || <span class="string">''</span></span><br><span class="line">        &#125; : &#123;</span><br><span class="line">          address: item.district+item.address,</span><br><span class="line">          longitude: location[<span class="number">0</span>],</span><br><span class="line">          latitude: location[<span class="number">1</span>],</span><br><span class="line">          district: item?.district || <span class="string">''</span>,</span><br><span class="line">          addressDetail: item?.address || <span class="string">''</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// this.selectAddr = &#123;</span></span><br><span class="line">        <span class="comment">//   address: item.pname?(item.pname+item.cityname+item.adname+item.address):(item.district+item.address),</span></span><br><span class="line">        <span class="comment">//   longitude: location[0],</span></span><br><span class="line">        <span class="comment">//   latitude: location[1],</span></span><br><span class="line">        <span class="comment">//   provice: item?.pname || '',</span></span><br><span class="line">        <span class="comment">//   city: item?.cityname || '',</span></span><br><span class="line">        <span class="comment">//   area: item?.adname || '',</span></span><br><span class="line">        <span class="comment">//   street: item?.pname || '',</span></span><br><span class="line">        <span class="comment">//   community: item?.pname || '',</span></span><br><span class="line">        <span class="comment">//   addressDetail: item?.address || ''</span></span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line">        <span class="keyword">this</span>.longitude = location[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">this</span>.latitude = location[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.markers[<span class="number">0</span>].longitude = location[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">this</span>.markers[<span class="number">0</span>].latitude = location[<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">this</span>.callout.content = item.name</span><br><span class="line">        <span class="keyword">this</span>.markers[<span class="number">0</span>].callout = <span class="keyword">this</span>.callout</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'select markers设置callout:'</span>, <span class="keyword">this</span>.markers)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// #ifdef APP-PLUS</span></span><br><span class="line">        <span class="keyword">this</span>.isManual = <span class="literal">false</span></span><br><span class="line">        <span class="comment">// #endif</span></span><br><span class="line">      &#125;,</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 手动移动 Map，根据中心定位移动传入的定位</span></span><br><span class="line">      regionchange(e) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'regionchange'</span>, e)</span><br><span class="line">        <span class="comment">// #ifdef MP-WEIXIN || H5</span></span><br><span class="line">        <span class="keyword">if</span> (e.type === <span class="string">'end'</span>) &#123;</span><br><span class="line">        <span class="comment">// #endif</span></span><br><span class="line">          <span class="keyword">this</span>.mapContext.getCenterLocation(&#123;</span><br><span class="line">            success: <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">              <span class="built_in">console</span>.log(<span class="string">'center'</span>, res)</span><br><span class="line">              <span class="comment">// #ifdef MP-WEIXIN || H5</span></span><br><span class="line">              <span class="keyword">const</span> around = e.causedBy === <span class="string">'drag'</span></span><br><span class="line">              <span class="comment">// #endif</span></span><br><span class="line"></span><br><span class="line">              <span class="comment">// #ifdef APP-PLUS</span></span><br><span class="line">              <span class="keyword">const</span> around = <span class="keyword">this</span>.isManual</span><br><span class="line">              <span class="comment">// #endif</span></span><br><span class="line">              <span class="keyword">this</span>.getAddressFormat(res.longitude, res.latitude, around)</span><br><span class="line">              <span class="keyword">this</span>.mapContext.translateMarker(&#123;</span><br><span class="line">                duration: <span class="number">100</span>,</span><br><span class="line">                markerId: <span class="number">0</span>,</span><br><span class="line">                destination: &#123; ...res &#125;</span><br><span class="line">              &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">        <span class="comment">// #ifdef MP-WEIXIN || H5</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// #endif </span></span><br><span class="line">      &#125;,</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 在地图上点击进行选点，这个选点在地图缩放比例较大时无效，因为精读的问题。</span></span><br><span class="line">      mapClick(e) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'mapClick'</span>, e)</span><br><span class="line">        <span class="comment">// #ifdef MP-WEIXIN || H5</span></span><br><span class="line">        <span class="keyword">this</span>.mapContext.translateMarker(</span><br><span class="line">          &#123;</span><br><span class="line">            duration: <span class="number">100</span>,</span><br><span class="line">            markerId: <span class="number">0</span>,</span><br><span class="line">            destination: &#123;...e.detail &#125; </span><br><span class="line">          &#125;</span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">this</span>.getAddressFormat(e.detail.longitude, e.detail.latitude)</span><br><span class="line">        <span class="comment">// #endif</span></span><br><span class="line">      &#125;,</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 获取指定定位信息与周围定位信息</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@params <span class="type">&#123; Boolean &#125;</span> </span>around 是否获取周围定位信息并渲染搜索列表 - 默认搜索</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      getAddressFormat(longitude, latitude, around = <span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (around) &#123;</span><br><span class="line">          myAmapFun.getRegeo(&#123;</span><br><span class="line">            location: longitude + <span class="string">','</span> + latitude,</span><br><span class="line">            success: <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">              <span class="built_in">console</span>.log(<span class="string">"获取指定定位信息"</span>, data)</span><br><span class="line">              <span class="keyword">this</span>.selectAddr = &#123;</span><br><span class="line">                address: data[<span class="number">0</span>].regeocodeData.formatted_address,</span><br><span class="line">                latitude: latitude,</span><br><span class="line">                longitude: longitude,</span><br><span class="line">                provice: data[<span class="number">0</span>].regeocodeData.addressComponent.province || <span class="string">''</span>,</span><br><span class="line">                city: data[<span class="number">0</span>].regeocodeData.addressComponent.city || <span class="string">''</span>,</span><br><span class="line">                district: data[<span class="number">0</span>].regeocodeData.addressComponent.district || <span class="string">''</span>,</span><br><span class="line">                street: data[<span class="number">0</span>].regeocodeData.addressComponent.township || <span class="string">''</span>,</span><br><span class="line">                addressDetail: data[<span class="number">0</span>].desc || <span class="string">''</span></span><br><span class="line">              &#125;</span><br><span class="line"></span><br><span class="line">              myAmapFun.getPoiAround(&#123;</span><br><span class="line">                location: data[<span class="number">0</span>].longitude+<span class="string">','</span>+data[<span class="number">0</span>].latitude,</span><br><span class="line">                success: <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">                  <span class="built_in">console</span>.log(<span class="string">"获取当前的列表"</span>, data)</span><br><span class="line">                  <span class="keyword">this</span>.dataTips = data.poisData</span><br><span class="line">                  <span class="keyword">this</span>.markers[<span class="number">0</span>].longitude = longitude</span><br><span class="line">                  <span class="keyword">this</span>.markers[<span class="number">0</span>].latitude = latitude</span><br><span class="line">                  <span class="keyword">this</span>.callout.content = data.poisData[<span class="number">0</span>].name</span><br><span class="line">                  <span class="keyword">this</span>.markers[<span class="number">0</span>].callout = <span class="keyword">this</span>.callout</span><br><span class="line">                  <span class="built_in">console</span>.log(<span class="string">'getAddressFormat markers设置callout:'</span>, <span class="keyword">this</span>.markers)</span><br><span class="line">                &#125;,</span><br><span class="line">                fail: <span class="function">(<span class="params">info</span>) =&gt;</span> &#123;</span><br><span class="line">                  <span class="built_in">console</span>.log(info)</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;)</span><br><span class="line">            &#125;,</span><br><span class="line">            fail: <span class="function">(<span class="params">info</span>) =&gt;</span> &#123;</span><br><span class="line">              <span class="built_in">console</span>.log(info)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// #ifdef APP-PLUS</span></span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">this</span>.isManual = <span class="literal">true</span></span><br><span class="line">        &#125;, <span class="number">1000</span>)</span><br><span class="line">        <span class="comment">// #endif</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// 根据内容进行检索</span></span><br><span class="line">      searchFn() &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"根据地址检索"</span>, <span class="keyword">this</span>.searchWords)</span><br><span class="line">        myAmapFun.getInputtips(&#123;</span><br><span class="line">          keywords: <span class="keyword">this</span>.searchWords,</span><br><span class="line">          location: <span class="string">''</span>,</span><br><span class="line">          success: <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'根据内容进行检索111'</span>, data)</span><br><span class="line">            <span class="keyword">if</span>(data &amp;&amp; data.tips) &#123; </span><br><span class="line">              <span class="keyword">this</span>.dataTips = data.tips</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          fail: <span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'根据内容进行检索222'</span>, data)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line"></span><br><span class="line">      <span class="comment">// #ifdef APP-PLUS </span></span><br><span class="line">      <span class="comment">// 兼容不同的手机系统</span></span><br><span class="line">      systemCompatible() &#123;</span><br><span class="line">        <span class="keyword">this</span>.systemType = uni.getSystemInfoSync()?.platform || <span class="string">''</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'用户手机操作系统:'</span>, <span class="keyword">this</span>.systemType)</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.systemType === <span class="string">'android'</span>) &#123;</span><br><span class="line">          <span class="keyword">this</span>.markers[<span class="number">0</span>].width = <span class="number">20</span></span><br><span class="line">          <span class="keyword">this</span>.markers[<span class="number">0</span>].height = <span class="number">20</span></span><br><span class="line">          <span class="keyword">this</span>.markers[<span class="number">0</span>].iconPath = <span class="string">'/static/home/icon_marker_x90px.png'</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// #endif</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;style lang="less" scoped&gt;</span></span><br><span class="line"><span class="regexp">  .btns &#123;</span></span><br><span class="line"><span class="regexp">    position: fixed;</span></span><br><span class="line"><span class="regexp">    top: 0;</span></span><br><span class="line"><span class="regexp">    left: 0;</span></span><br><span class="line"><span class="regexp">    height: 145rpx;</span></span><br><span class="line"><span class="regexp">    width: 100%;</span></span><br><span class="line"><span class="regexp">    background: linear-gradient(to bottom,rgba(0,0,0,0.4),rgba(0,0,0,0));</span></span><br><span class="line"><span class="regexp">    display: flex;</span></span><br><span class="line"><span class="regexp">    align-items: flex-end;</span></span><br><span class="line"><span class="regexp">    justify-content: space-between;</span></span><br><span class="line"><span class="regexp">    z-index: 10!important;</span></span><br><span class="line"><span class="regexp">    view &#123; </span></span><br><span class="line"><span class="regexp">      margin: 100rpx 24rpx 0;</span></span><br><span class="line"><span class="regexp">      font-size: 30rpx;</span></span><br><span class="line"><span class="regexp">      &amp;:first-child &#123; </span></span><br><span class="line"><span class="regexp">        color: #fff;</span></span><br><span class="line"><span class="regexp">      &#125;</span></span><br><span class="line"><span class="regexp">      &amp;:last-child &#123; </span></span><br><span class="line"><span class="regexp">        width: 100rpx;</span></span><br><span class="line"><span class="regexp">        height: 60rpx;</span></span><br><span class="line"><span class="regexp">        line-height: 60rpx;</span></span><br><span class="line"><span class="regexp">        text-align: center;</span></span><br><span class="line"><span class="regexp">        border-radius: 10rpx;</span></span><br><span class="line"><span class="regexp">        background: #397BE2;</span></span><br><span class="line"><span class="regexp">        color: #fff;</span></span><br><span class="line"><span class="regexp">      &#125;</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">    .btns-icon &#123;</span></span><br><span class="line"><span class="regexp">      margin-left: 26rpx;</span></span><br><span class="line">      /* #ifdef APP-PLUS */</span><br><span class="line">      font-size: <span class="number">48</span>rpx;</span><br><span class="line">      <span class="comment">/* #endif */</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  .content &#123;</span><br><span class="line">    .map &#123;</span><br><span class="line">      width: <span class="number">100</span>%;</span><br><span class="line">      <span class="comment">/* #ifdef MP-WEIXIN || H5 */</span></span><br><span class="line">      height: <span class="number">60</span>vh;</span><br><span class="line">      <span class="comment">/* #endif */</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">/* #ifdef APP-PLUS */</span></span><br><span class="line">      height: <span class="number">46</span>vh;</span><br><span class="line">      <span class="comment">/* #endif */</span></span><br><span class="line">    &#125;</span><br><span class="line">    .list &#123;</span><br><span class="line">      <span class="comment">/* #ifdef MP-WEIXIN || H5 */</span></span><br><span class="line">      height: calc(<span class="number">40</span>vh - <span class="number">100</span>rpx);</span><br><span class="line">      margin: <span class="number">-40</span>rpx auto <span class="number">0</span>;</span><br><span class="line">      <span class="comment">/* #endif */</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">/* #ifdef APP-PLUS */</span></span><br><span class="line">      <span class="comment">// height: 54vh;</span></span><br><span class="line">      margin: <span class="number">-30</span>rpx auto <span class="number">0</span>;</span><br><span class="line">      -webkit-overflow-scrolling: touch;</span><br><span class="line">      <span class="comment">/* #endif */</span></span><br><span class="line"></span><br><span class="line">      overflow-y: auto;</span><br><span class="line">      width: <span class="number">702</span>rpx;</span><br><span class="line">      padding-bottom: <span class="number">20</span>rpx;</span><br><span class="line">      .item &#123;</span><br><span class="line">        border-bottom: 2rpx solid #f3f3f3;</span><br><span class="line">        &amp;:last-child &#123;</span><br><span class="line">          border: none;</span><br><span class="line">        &#125;</span><br><span class="line">        .address &#123;</span><br><span class="line">          font-size: <span class="number">22</span>rpx;</span><br><span class="line">          color: #666;</span><br><span class="line">          margin: <span class="number">10</span>rpx <span class="number">0</span>;</span><br><span class="line">          display: flex;</span><br><span class="line">          justify-content: space-between;</span><br><span class="line">        &#125;</span><br><span class="line">        .name &#123;</span><br><span class="line">          font-size: <span class="number">30</span>rpx;</span><br><span class="line">          color: #333;</span><br><span class="line">          margin-top: <span class="number">10</span>rpx;</span><br><span class="line">        &#125;</span><br><span class="line">        &amp;.active &#123;</span><br><span class="line">          .name &#123;</span><br><span class="line">            font-weight: bold;</span><br><span class="line">            color: #397BE2;</span><br><span class="line">          &#125;</span><br><span class="line">          .address &#123;</span><br><span class="line">            color: #397BE2;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    .inputCon &#123;</span><br><span class="line">      width: <span class="number">100</span>%;</span><br><span class="line">      background: #fff;</span><br><span class="line">      height: <span class="number">100</span>rpx;</span><br><span class="line">      position: relative;</span><br><span class="line">      z-index: <span class="number">20</span>;</span><br><span class="line">      display: flex;</span><br><span class="line">      align-items: center;</span><br><span class="line">      justify-content: space-between;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/* #ifdef MP-WEIXIN || H5 */</span></span><br><span class="line">      top: <span class="number">-60</span>rpx;</span><br><span class="line">      <span class="comment">/* #endif */</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">/* #ifdef APP-PLUS */</span></span><br><span class="line">      margin-top: <span class="number">10</span>rpx;</span><br><span class="line">      top: <span class="number">-20</span>rpx;</span><br><span class="line">      <span class="comment">/* #endif */</span></span><br><span class="line"></span><br><span class="line">      .searchView &#123;</span><br><span class="line">        margin-left: <span class="number">16</span>rpx;</span><br><span class="line">        min-width: <span class="number">590</span>rpx;</span><br><span class="line">        height: <span class="number">60</span>rpx;</span><br><span class="line">        display: flex;</span><br><span class="line">        align-items: center;</span><br><span class="line">        line-height: <span class="number">60</span>rpx;</span><br><span class="line">        border-radius: <span class="number">40</span>rpx;</span><br><span class="line">        padding: <span class="number">0</span> <span class="number">30</span>rpx;</span><br><span class="line">        box-sizing: border-box;</span><br><span class="line">        background: #f3f3f3;</span><br><span class="line">        font-size:<span class="number">26</span>rpx;</span><br><span class="line">        .iconfont &#123; </span><br><span class="line">          color: #666;</span><br><span class="line">          margin-right: <span class="number">16</span>rpx;</span><br><span class="line">          display: flex;</span><br><span class="line">          align-items: center;</span><br><span class="line">        &#125;</span><br><span class="line">        input &#123; </span><br><span class="line">          flex: <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        view &#123; </span><br><span class="line">          flex-shrink: <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        .cancel &#123;</span><br><span class="line">          color: rgb(<span class="number">152</span>, <span class="number">152</span>, <span class="number">152</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      .operate &#123;</span><br><span class="line">        padding-right: <span class="number">20</span>rpx;</span><br><span class="line">        font-size: <span class="number">28</span>rpx;</span><br><span class="line">        text &#123;</span><br><span class="line">          padding: <span class="number">6</span>rpx <span class="number">20</span>rpx;</span><br><span class="line">          text-align: center;</span><br><span class="line">          border-radius: <span class="number">10</span>rpx;</span><br><span class="line">          background: #397BE2;</span><br><span class="line">          color: #fff;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;<span class="regexp">/style&gt;</span></span><br></pre></td></tr></table></figure>

<p><a href="https://www.dandelioncloud.cn/article/details/1419298546372907010" target="_blank" rel="noopener">参考文章</a></p>
<hr>
<h4 id="14-uCharts-图表-APP、小程序-真机不随页面滚动的问题"><a href="#14-uCharts-图表-APP、小程序-真机不随页面滚动的问题" class="headerlink" title="14. uCharts 图表(APP、小程序)真机不随页面滚动的问题"></a>14. <font color="#00AAF0">uCharts 图表(APP、小程序)真机不随页面滚动的问题</font></h4><p>在 <a href="https://www.ucharts.cn/v2/#/document/index" target="_blank" rel="noopener">uCharts 文档</a> “基础配置”中有 <code>canvas2d</code> 属性，其说明：“canvas2d模式，用于解决小程序层级过高及拖拽卡顿问题，小程序平台开启后context及canvas的格式不同，详见【指南】中说明”，而我也在<code>option</code>配置中定义了，在开发这工具中是没问题，但是小程序在真机上依旧实现不了随页面滚动。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">// 配置项</span></span><br><span class="line">  options: &#123;</span><br><span class="line">    type: <span class="string">"ring"</span>,</span><br><span class="line">    color: [<span class="string">'#2E8CE8'</span>, <span class="string">'#FFBE04'</span>],</span><br><span class="line">    fontSize: <span class="number">16</span>,</span><br><span class="line">    fontColor: <span class="string">'#000000'</span>,</span><br><span class="line">    dataLabel: <span class="literal">false</span>,</span><br><span class="line">    <span class="comment">// dataPointShape: false</span></span><br><span class="line">    <span class="comment">// 使图标随页面滚动</span></span><br><span class="line">    canvas2d: <span class="literal">true</span>,</span><br><span class="line">    title: &#123;</span><br><span class="line">      name: <span class="string">'0'</span>,</span><br><span class="line">      fontSize: <span class="number">18</span>,</span><br><span class="line">      color: <span class="string">'#2E8CE8'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    subtitle: &#123;</span><br><span class="line">      name: <span class="string">'睡眠时长'</span>,</span><br><span class="line">      fontSize: <span class="number">12</span>,</span><br><span class="line">      color: <span class="string">'#999999'</span>,</span><br><span class="line">      offsetY: <span class="number">10</span></span><br><span class="line">    &#125;,</span><br><span class="line">    legend: &#123;</span><br><span class="line">      lineHeight: <span class="number">35</span></span><br><span class="line">    &#125;,</span><br><span class="line">    extra: &#123;</span><br><span class="line">      ring: &#123;</span><br><span class="line">        border: <span class="literal">false</span>,</span><br><span class="line">        <span class="comment">// borderWidth: 0,</span></span><br><span class="line">        <span class="comment">// borderColor: ''</span></span><br><span class="line">      &#125;,</span><br><span class="line">      tooltip: &#123;</span><br><span class="line">        <span class="comment">// showBox: false</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 数据项</span></span><br><span class="line">  data: &#123;</span><br><span class="line">    series: [</span><br><span class="line">      &#123;</span><br><span class="line">        name: <span class="string">"浅睡时长"</span>,</span><br><span class="line">        data: <span class="number">0</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        name: <span class="string">"深睡时长"</span>,</span><br><span class="line">        data: <span class="number">0</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但是仔细查阅文档在“组件Props”说明中也有 <code>canvas2d</code> 属性，其说明：“是否开启canvas2d模式，用于解决小程序层级过高问题。注：开启canvas2d模式，必须要传入上面的canvasId【随机字符串，不能是数字开头！】<code>不能“真机调试”</code> <code>需要扫码预览</code> <code>IDE显示不准确</code>”，此属性在真机上是有效的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;qiun-data-charts</span><br><span class="line">    type&#x3D;&quot;ring&quot;</span><br><span class="line">    :chartData&#x3D;&quot;sportsHealth.data&quot;</span><br><span class="line">    :opts&#x3D;&quot;sportsHealth.options&quot;</span><br><span class="line">    :tooltipCustom&#x3D;&quot;tooltipCustom&quot;</span><br><span class="line">    :ontap&#x3D;&quot;false&quot;</span><br><span class="line">    :canvas2d&#x3D;&quot;true&quot;</span><br><span class="line">&#x2F;&gt;</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="15-uniapp-android-和IOS-权限-utils"><a href="#15-uniapp-android-和IOS-权限-utils" class="headerlink" title="15 uniapp android 和IOS 权限 utils"></a>15 <font color="#00AAF0">uniapp android 和IOS 权限 utils</font></h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 本模块封装了Android、iOS的应用权限判断、打开应用权限设置界面、以及位置系统服务是否开启</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> isIos</span><br><span class="line"><span class="comment">// #ifdef APP-PLUS</span></span><br><span class="line">isIos = (plus.os.name == <span class="string">"iOS"</span>)</span><br><span class="line"><span class="comment">// #endif</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断推送权限是否开启</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">judgeIosPermissionPush</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> result = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">var</span> UIApplication = plus.ios.import(<span class="string">"UIApplication"</span>);</span><br><span class="line">    <span class="keyword">var</span> app = UIApplication.sharedApplication();</span><br><span class="line">    <span class="keyword">var</span> enabledTypes = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (app.currentUserNotificationSettings) &#123;</span><br><span class="line">        <span class="keyword">var</span> settings = app.currentUserNotificationSettings();</span><br><span class="line">        enabledTypes = settings.plusGetAttribute(<span class="string">"types"</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"enabledTypes1:"</span> + enabledTypes);</span><br><span class="line">        <span class="keyword">if</span> (enabledTypes == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"推送权限没有开启"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            result = <span class="literal">true</span>;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"已经开启推送功能!"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        plus.ios.deleteObject(settings);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        enabledTypes = app.enabledRemoteNotificationTypes();</span><br><span class="line">        <span class="keyword">if</span> (enabledTypes == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"推送权限没有开启!"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            result = <span class="literal">true</span>;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"已经开启推送功能!"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"enabledTypes2:"</span> + enabledTypes);</span><br><span class="line">    &#125;</span><br><span class="line">    plus.ios.deleteObject(app);</span><br><span class="line">    plus.ios.deleteObject(UIApplication);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断定位权限是否开启</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">judgeIosPermissionLocation</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> result = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">var</span> cllocationManger = plus.ios.import(<span class="string">"CLLocationManager"</span>);</span><br><span class="line">    <span class="keyword">var</span> status = cllocationManger.authorizationStatus();</span><br><span class="line">    result = (status != <span class="number">2</span>)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"定位权限开启："</span> + result);</span><br><span class="line">    <span class="comment">// 以下代码判断了手机设备的定位是否关闭，推荐另行使用方法 checkSystemEnableLocation</span></span><br><span class="line">    <span class="comment">/* var enable = cllocationManger.locationServicesEnabled();</span></span><br><span class="line"><span class="comment">    var status = cllocationManger.authorizationStatus();</span></span><br><span class="line"><span class="comment">    console.log("enable:" + enable);</span></span><br><span class="line"><span class="comment">    console.log("status:" + status);</span></span><br><span class="line"><span class="comment">    if (enable &amp;&amp; status != 2) &#123;</span></span><br><span class="line"><span class="comment">        result = true;</span></span><br><span class="line"><span class="comment">        console.log("手机定位服务已开启且已授予定位权限");</span></span><br><span class="line"><span class="comment">    &#125; else &#123;</span></span><br><span class="line"><span class="comment">        console.log("手机系统的定位没有打开或未给予定位权限");</span></span><br><span class="line"><span class="comment">    &#125; */</span></span><br><span class="line">    plus.ios.deleteObject(cllocationManger);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**    </span></span><br><span class="line"><span class="comment"> * 申请麦克风权限 requestRecordPermission    </span></span><br><span class="line"><span class="comment"> * 调用入参：handler回调函数（无回调结果）   </span></span><br><span class="line"><span class="comment"> *   </span></span><br><span class="line"><span class="comment"> * 当权限状态为：1970168948用户未作出选择时，调用此方法系统会弹出提示框让用户确认授权    </span></span><br><span class="line"><span class="comment"> * 当权限状态非：1970168948时，只能跳转到系统设置界面，让用户手动开启，使用plus.runtime.openURL("app-settings://");跳转，或者gotoAppPermissionSetting（参考插件https://ext.dcloud.net.cn/plugin?id=594）    </span></span><br><span class="line"><span class="comment">* 获取麦克风权限状态 recordPermission  </span></span><br><span class="line"><span class="comment"> *   </span></span><br><span class="line"><span class="comment"> * 返回状态：RecordPermissions  </span></span><br><span class="line"><span class="comment"> * 参考：https://developer.apple.com/documentation/avfaudio/avaudiosessionrecordpermission  </span></span><br><span class="line"><span class="comment"> * AVAudioSessionRecordPermissionUndetermined = 1970168948,     用户未作出选择  </span></span><br><span class="line"><span class="comment"> * AVAudioSessionRecordPermissionDenied = 1684369017,           用户已明确拒绝  </span></span><br><span class="line"><span class="comment"> * AVAudioSessionRecordPermissionGranted = 1735552628,          用户已授权  </span></span><br><span class="line"><span class="comment"> */</span> </span><br><span class="line"><span class="comment">// 判断麦克风权限是否开启</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">judgeIosPermissionRecord</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> result = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">var</span> avaudiosession = plus.ios.import(<span class="string">"AVAudioSession"</span>);</span><br><span class="line">    <span class="keyword">var</span> avaudio = avaudiosession.sharedInstance();</span><br><span class="line">    <span class="keyword">var</span> permissionStatus = avaudio.recordPermission();</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"permissionStatus:"</span> + permissionStatus);</span><br><span class="line">    <span class="keyword">if</span> (permissionStatus == <span class="number">1684369017</span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"麦克风权限没有开启"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (permissionStatus == <span class="number">1970168948</span>) &#123;</span><br><span class="line">        result = <span class="literal">true</span></span><br><span class="line">        <span class="comment">// 箭头函数一定要加！否则用户拒绝会闪退！！！</span></span><br><span class="line">        avaudio.requestRecordPermission(<span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        result = <span class="literal">true</span>;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"麦克风权限已经开启"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    plus.ios.deleteObject(avaudiosession);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断相机权限是否开启</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">judgeIosPermissionCamera</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> result = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">var</span> AVCaptureDevice = plus.ios.import(<span class="string">"AVCaptureDevice"</span>);</span><br><span class="line">    <span class="keyword">var</span> authStatus = AVCaptureDevice.authorizationStatusForMediaType(<span class="string">'vide'</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"authStatus:"</span> + authStatus);</span><br><span class="line">    <span class="keyword">if</span> (authStatus == <span class="number">3</span>) &#123;</span><br><span class="line">        result = <span class="literal">true</span>;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"相机权限已经开启"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"相机权限没有开启"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    plus.ios.deleteObject(AVCaptureDevice);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断相册权限是否开启</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">judgeIosPermissionPhotoLibrary</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> result = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">var</span> PHPhotoLibrary = plus.ios.import(<span class="string">"PHPhotoLibrary"</span>);</span><br><span class="line">    <span class="keyword">var</span> authStatus = PHPhotoLibrary.authorizationStatus();</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"authStatus:"</span> + authStatus);</span><br><span class="line">    <span class="keyword">if</span> (authStatus == <span class="number">3</span>) &#123;</span><br><span class="line">        result = <span class="literal">true</span>;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"相册权限已经开启"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"相册权限没有开启"</span>);</span><br><span class="line">        gotoAppPermissionSetting()</span><br><span class="line">    &#125;</span><br><span class="line">    plus.ios.deleteObject(PHPhotoLibrary);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断通讯录权限是否开启</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">judgeIosPermissionContact</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> result = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">var</span> CNContactStore = plus.ios.import(<span class="string">"CNContactStore"</span>);</span><br><span class="line">    <span class="keyword">var</span> cnAuthStatus = CNContactStore.authorizationStatusForEntityType(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (cnAuthStatus == <span class="number">3</span>) &#123;</span><br><span class="line">        result = <span class="literal">true</span>;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"通讯录权限已经开启"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"通讯录权限没有开启"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    plus.ios.deleteObject(CNContactStore);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断日历权限是否开启</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">judgeIosPermissionCalendar</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> result = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">var</span> EKEventStore = plus.ios.import(<span class="string">"EKEventStore"</span>);</span><br><span class="line">    <span class="keyword">var</span> ekAuthStatus = EKEventStore.authorizationStatusForEntityType(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (ekAuthStatus == <span class="number">3</span>) &#123;</span><br><span class="line">        result = <span class="literal">true</span>;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"日历权限已经开启"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"日历权限没有开启"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    plus.ios.deleteObject(EKEventStore);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断备忘录权限是否开启</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">judgeIosPermissionMemo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> result = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">var</span> EKEventStore = plus.ios.import(<span class="string">"EKEventStore"</span>);</span><br><span class="line">    <span class="keyword">var</span> ekAuthStatus = EKEventStore.authorizationStatusForEntityType(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (ekAuthStatus == <span class="number">3</span>) &#123;</span><br><span class="line">        result = <span class="literal">true</span>;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"备忘录权限已经开启"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"备忘录权限没有开启"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    plus.ios.deleteObject(EKEventStore);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Android权限查询</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">requestAndroidPermission</span>(<span class="params">permissionID</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        plus.android.requestPermissions(</span><br><span class="line">            [permissionID], <span class="comment">// 理论上支持多个权限同时查询，但实际上本函数封装只处理了一个权限的情况。有需要的可自行扩展封装</span></span><br><span class="line">            <span class="function"><span class="keyword">function</span>(<span class="params">resultObj</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">var</span> result = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; resultObj.granted.length; i++) &#123;</span><br><span class="line">                    <span class="keyword">var</span> grantedPermission = resultObj.granted[i];</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">'已获取的权限：'</span> + grantedPermission);</span><br><span class="line">                    result = <span class="number">1</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; resultObj.deniedPresent.length; i++) &#123;</span><br><span class="line">                    <span class="keyword">var</span> deniedPresentPermission = resultObj.deniedPresent[i];</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">'拒绝本次申请的权限：'</span> + deniedPresentPermission);</span><br><span class="line">                    result = <span class="number">0</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; resultObj.deniedAlways.length; i++) &#123;</span><br><span class="line">                    <span class="keyword">var</span> deniedAlwaysPermission = resultObj.deniedAlways[i];</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">'永久拒绝申请的权限：'</span> + deniedAlwaysPermission);</span><br><span class="line">                    result = <span class="number">-1</span></span><br><span class="line">                &#125;</span><br><span class="line">                resolve(result);</span><br><span class="line">                <span class="comment">// 若所需权限被拒绝,则打开APP设置界面,可以在APP设置界面打开相应权限</span></span><br><span class="line">                <span class="keyword">if</span> (result == <span class="number">-1</span>) &#123;</span><br><span class="line">                    <span class="comment">// gotoAppPermissionSetting()</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="function"><span class="keyword">function</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">'申请权限错误：'</span> + error.code + <span class="string">" = "</span> + error.message);</span><br><span class="line">                resolve(&#123;</span><br><span class="line">                    code: error.code,</span><br><span class="line">                    message: error.message</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        );</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用一个方法，根据参数判断权限</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">judgeIosPermission</span>(<span class="params">permissionID</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (permissionID == <span class="string">"location"</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> judgeIosPermissionLocation()</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (permissionID == <span class="string">"camera"</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> judgeIosPermissionCamera()</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (permissionID == <span class="string">"photoLibrary"</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> judgeIosPermissionPhotoLibrary()</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (permissionID == <span class="string">"record"</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> judgeIosPermissionRecord()</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (permissionID == <span class="string">"push"</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> judgeIosPermissionPush()</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (permissionID == <span class="string">"contact"</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> judgeIosPermissionContact()</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (permissionID == <span class="string">"calendar"</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> judgeIosPermissionCalendar()</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (permissionID == <span class="string">"memo"</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> judgeIosPermissionMemo()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 跳转到**应用**的权限页面</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">gotoAppPermissionSetting</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (isIos) &#123;</span><br><span class="line">        <span class="keyword">var</span> UIApplication = plus.ios.import(<span class="string">"UIApplication"</span>);</span><br><span class="line">        <span class="keyword">var</span> application2 = UIApplication.sharedApplication();</span><br><span class="line">        <span class="keyword">var</span> NSURL2 = plus.ios.import(<span class="string">"NSURL"</span>);</span><br><span class="line">        <span class="comment">// var setting2 = NSURL2.URLWithString("prefs:root=LOCATION_SERVICES");        </span></span><br><span class="line">        <span class="keyword">var</span> setting2 = NSURL2.URLWithString(<span class="string">"app-settings:"</span>);</span><br><span class="line">        application2.openURL(setting2);</span><br><span class="line"></span><br><span class="line">        plus.ios.deleteObject(setting2);</span><br><span class="line">        plus.ios.deleteObject(NSURL2);</span><br><span class="line">        plus.ios.deleteObject(application2);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// console.log(plus.device.vendor);</span></span><br><span class="line">        <span class="keyword">var</span> Intent = plus.android.importClass(<span class="string">"android.content.Intent"</span>);</span><br><span class="line">        <span class="keyword">var</span> Settings = plus.android.importClass(<span class="string">"android.provider.Settings"</span>);</span><br><span class="line">        <span class="keyword">var</span> Uri = plus.android.importClass(<span class="string">"android.net.Uri"</span>);</span><br><span class="line">        <span class="keyword">var</span> mainActivity = plus.android.runtimeMainActivity();</span><br><span class="line">        <span class="keyword">var</span> intent = <span class="keyword">new</span> Intent();</span><br><span class="line">        intent.setAction(Settings.ACTION_APPLICATION_DETAILS_SETTINGS);</span><br><span class="line">        <span class="keyword">var</span> uri = Uri.fromParts(<span class="string">"package"</span>, mainActivity.getPackageName(), <span class="literal">null</span>);</span><br><span class="line">        intent.setData(uri);</span><br><span class="line">        mainActivity.startActivity(intent);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 检查系统的设备服务是否开启</span></span><br><span class="line"><span class="comment">// var checkSystemEnableLocation = async function () &#123;</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkSystemEnableLocation</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (isIos) &#123;</span><br><span class="line">        <span class="keyword">var</span> result = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">var</span> cllocationManger = plus.ios.import(<span class="string">"CLLocationManager"</span>);</span><br><span class="line">        <span class="keyword">var</span> result = cllocationManger.locationServicesEnabled();</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"系统定位开启:"</span> + result);</span><br><span class="line">        plus.ios.deleteObject(cllocationManger);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> context = plus.android.importClass(<span class="string">"android.content.Context"</span>);</span><br><span class="line">        <span class="keyword">var</span> locationManager = plus.android.importClass(<span class="string">"android.location.LocationManager"</span>);</span><br><span class="line">        <span class="keyword">var</span> main = plus.android.runtimeMainActivity();</span><br><span class="line">        <span class="keyword">var</span> mainSvr = main.getSystemService(context.LOCATION_SERVICE);</span><br><span class="line">        <span class="keyword">var</span> result = mainSvr.isProviderEnabled(locationManager.GPS_PROVIDER);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"系统定位开启:"</span> + result);</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    judgeIosPermission: judgeIosPermission,</span><br><span class="line">    requestAndroidPermission: requestAndroidPermission,</span><br><span class="line">    checkSystemEnableLocation: checkSystemEnableLocation,</span><br><span class="line">    gotoAppPermissionSetting: gotoAppPermissionSetting</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<hr>
<h4 id="16-解决uCharts图表有数据却无法显示的问题"><a href="#16-解决uCharts图表有数据却无法显示的问题" class="headerlink" title="16. 解决uCharts图表有数据却无法显示的问题"></a>16. <font color="#00AAF0">解决uCharts图表有数据却无法显示的问题</font></h4><blockquote>
<p><font color="red">部分</font>ucharts图表data value的值必须是数字类型才能加载出图表</p>
</blockquote>
<p>最近在做小程序 <code>pie图</code> 使用 <code>uCharts</code> 时图表始终无法显示，开始以为是后端返回数据或者异步的问题，但是通过deBug发现依旧不能显示。仔细看才发现文档示例data value的值全是<code>Number</code>类型，而我的全是<code>Sting</code>，替换后发现就可以了！这……，不知道是怪自己不细心，还是怪它文档也不说明，唉！</p>
<p>后来…它文档终于补上了这些说明…</p>
<hr>
<h4 id="17-vant-van-picker调节选项距离顶部的高度"><a href="#17-vant-van-picker调节选项距离顶部的高度" class="headerlink" title="17. vant van-picker调节选项距离顶部的高度"></a>17. <font color="#00AAF0">vant <code>van-picker</code>调节选项距离顶部的高度</font></h4><blockquote>
<p><code>visible-item-count</code> 属性可调节选项距离顶部的高度</p>
<p><code>van-picker</code>中<code>:visible-item-count=&quot;3&quot;</code>可见item个数可调节选项距离顶部的高度</p>
</blockquote>
<hr>
<h4 id="18-解决uniapp在onLaunch中使用redirectTo或reLaunch跳转页面后点击事件失效问题"><a href="#18-解决uniapp在onLaunch中使用redirectTo或reLaunch跳转页面后点击事件失效问题" class="headerlink" title="18. 解决uniapp在onLaunch中使用redirectTo或reLaunch跳转页面后点击事件失效问题"></a>18. <font color="#00AAF0">解决uniapp在onLaunch中使用redirectTo或reLaunch跳转页面后点击事件失效问题</font></h4><p>使用uniapp编译成小程序时，在onLaunch中重定向会导致点击事件失效，但是，如果，你重定向的页面中有使用navigator组件跳转后再返回，点击事件又有效了，在原生微信小程序中重定向没有问题。</p>
<p><strong>onLaunch中重定向失效</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">onLaunch() &#123;</span><br><span class="line">    uni.reLaunch(&#123;</span><br><span class="line">        url: <span class="string">'/pages/user/user'</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>解决办法</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">onLaunch() &#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      uni.reLaunch(&#123;</span><br><span class="line">          url: <span class="string">'/pages/user/user'</span></span><br><span class="line">      &#125;)</span><br><span class="line">  &#125;, <span class="number">0</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用延迟后，则不会出现。</p>
<hr>
<h4 id="19-uni-app开发canvas在小程序端或者h5端不生效"><a href="#19-uni-app开发canvas在小程序端或者h5端不生效" class="headerlink" title="19. uni-app开发canvas在小程序端或者h5端不生效"></a>19. <font color="#00AAF0">uni-app开发canvas在小程序端或者h5端不生效</font></h4><p>有以下几种可能：</p>
<p>(1) 如果在canvas标签中写了<code>type=“2d“</code>，则在小程序端会无法显示，删掉即可</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;canvas</span><br><span class="line">  type=<span class="string">"2d"</span></span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>

<p>(2) 习惯h5的写法只写了<code>id</code>没有写<code>canvas-id</code>，也会无法显示</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;canvas</span><br><span class="line">	id=<span class="string">"canvasId"</span></span><br><span class="line">  canvas-id=<span class="string">"canvasId"</span></span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>

<p>(3) 如果是旧版本，没有写在创建canvas的时候没有写this也有可能导致不显示（其实用现在的新版本，不写this也是可以显示的 但是建议写上） </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> context = uni.createCanvasContext(<span class="string">'canvasId'</span>, <span class="keyword">this</span>)</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="20-uCharts中图表无法横向滚动"><a href="#20-uCharts中图表无法横向滚动" class="headerlink" title="20. uCharts中图表无法横向滚动"></a>20. <font color="#00AAF0">uCharts中图表无法横向滚动</font></h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;view <span class="class"><span class="keyword">class</span></span>=<span class="string">"chart"</span>&gt;</span><br><span class="line">    &lt;qiun-data-charts</span><br><span class="line">      :type=<span class="string">"heartRateOpts.type"</span></span><br><span class="line">      :opts=<span class="string">"heartRateOpts"</span></span><br><span class="line">      :chartData=<span class="string">"heartRateData"</span></span><br><span class="line">      :canvas2d=<span class="string">"true"</span></span><br><span class="line">      tooltipFormat=<span class="string">"tooltipxyAxis"</span></span><br><span class="line">      v-<span class="keyword">if</span>=<span class="string">"Object.values(heartRateData).length &amp;&amp; !dateShow"</span></span><br><span class="line">    /&gt;</span><br><span class="line">	&lt;<span class="regexp">/view&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    data() &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        heartRateOpts: &#123;</span><br><span class="line">          type: <span class="string">'line'</span></span><br><span class="line">          update: <span class="literal">true</span>,</span><br><span class="line">          enableScroll: <span class="literal">true</span>, <span class="comment">// 开启x轴滚动</span></span><br><span class="line">          xAxis: &#123;</span><br><span class="line">            boundaryGap: <span class="string">'justify'</span>,</span><br><span class="line">            itemCount: <span class="number">20</span>, <span class="comment">// 开启enableScroll必须设置此字段</span></span><br><span class="line">            fontSize: <span class="number">12</span>,</span><br><span class="line">            format: <span class="string">'xyAxisEmptyData'</span>,</span><br><span class="line">            axisLineColor: <span class="string">'#EBEBEB'</span>,</span><br><span class="line">            <span class="comment">// scrollShow: true // 是否显示滚动条</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>

<p>设置了<code>enableScroll</code>也没用</p>
<p><strong>解决方法:</strong></p>
<p>需要在组件中开启<code>ontouch</code>属性</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;qiun-data-charts</span><br><span class="line">  :type=<span class="string">"heartRateOpts.type"</span></span><br><span class="line">  :opts=<span class="string">"heartRateOpts"</span></span><br><span class="line">  :chartData=<span class="string">"heartRateData"</span></span><br><span class="line">  :canvas2d=<span class="string">"true"</span></span><br><span class="line">  :ontouch=<span class="string">"true"</span></span><br><span class="line">  tooltipFormat=<span class="string">"tooltipxyAxis"</span></span><br><span class="line">  v-<span class="keyword">if</span>=<span class="string">"Object.values(heartRateData).length &amp;&amp; !dateShow"</span></span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="21-ucharts隐藏x或y轴刻度值"><a href="#21-ucharts隐藏x或y轴刻度值" class="headerlink" title="21. ucharts隐藏x或y轴刻度值"></a>21. <font color="#00AAF0">ucharts隐藏x或y轴刻度值</font></h4><blockquote>
<p>前提：你使用的是组件形式的，而不是原生的</p>
</blockquote>
<h5 id="1-在config-ucharts-js-添加自定义方法"><a href="#1-在config-ucharts-js-添加自定义方法" class="headerlink" title="(1) 在config-ucharts.js 添加自定义方法"></a>(1) 在<code>config-ucharts.js</code> 添加自定义方法</h5><p>例: <code>xyAxisEmptyData</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//下面是自定义format配置，因除H5端外的其他端无法通过props传递函数，只能通过此属性对应下标的方式来替换</span></span><br><span class="line"> <span class="string">"formatter"</span>:&#123;</span><br><span class="line">     <span class="string">"xyAxisEmptyData"</span>:<span class="function"><span class="keyword">function</span>(<span class="params">val, index, opts</span>)</span>&#123;<span class="keyword">return</span> <span class="string">''</span>&#125;,</span><br><span class="line">     <span class="string">"yAxisDemo1"</span>:<span class="function"><span class="keyword">function</span>(<span class="params">val, index, opts</span>)</span>&#123;<span class="keyword">return</span> val+<span class="string">'元'</span>&#125;,</span><br><span class="line">     <span class="string">"yAxisDemo2"</span>:<span class="function"><span class="keyword">function</span>(<span class="params">val, index, opts</span>)</span>&#123;<span class="keyword">return</span> val.toFixed(<span class="number">2</span>)&#125;,</span><br><span class="line">     <span class="string">"xAxisDemo1"</span>:<span class="function"><span class="keyword">function</span>(<span class="params">val, index, opts</span>)</span>&#123;<span class="keyword">return</span> val+<span class="string">'年'</span>;&#125;,</span><br><span class="line">     <span class="string">"xAxisDemo2"</span>:<span class="function"><span class="keyword">function</span>(<span class="params">val, index, opts</span>)</span>&#123;<span class="keyword">return</span> formatDateTime(val,<span class="string">'h:m'</span>)&#125;,</span><br><span class="line">     <span class="string">"seriesDemo1"</span>:<span class="function"><span class="keyword">function</span>(<span class="params">val, index, series, opts</span>)</span>&#123;<span class="keyword">return</span> val+<span class="string">'元'</span>&#125;,</span><br><span class="line">     <span class="string">"tooltipDelxAxis"</span>:<span class="function"><span class="keyword">function</span>(<span class="params">item, category, index, opts</span>)</span>&#123;</span><br><span class="line">       <span class="keyword">return</span> item.name + <span class="string">': '</span> + (item.data || <span class="number">0</span>)</span><br><span class="line">     &#125;,</span><br><span class="line">     <span class="string">"tooltipxyAxis"</span>:<span class="function"><span class="keyword">function</span>(<span class="params">item, category, index, opts</span>)</span>&#123;</span><br><span class="line">       <span class="comment">// console.log('item', item)</span></span><br><span class="line">       <span class="comment">// console.log('category', category)</span></span><br><span class="line">       <span class="comment">// console.log('index', index)</span></span><br><span class="line">       <span class="comment">// console.log('opts', opts)</span></span><br><span class="line">       <span class="keyword">return</span> category + <span class="string">': '</span> + (item.data || <span class="number">0</span>)</span><br><span class="line">     &#125;,</span><br><span class="line">     <span class="string">"tooltipDemo1"</span>:<span class="function"><span class="keyword">function</span>(<span class="params">item, category, index, opts</span>)</span>&#123;</span><br><span class="line">       <span class="keyword">if</span>(index==<span class="number">0</span>)&#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="string">'随便用'</span>+item.data+<span class="string">'年'</span></span><br><span class="line">       &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="string">'其他我没改'</span>+item.data+<span class="string">'天'</span></span><br><span class="line">       &#125;</span><br><span class="line">     &#125;,</span><br><span class="line">     <span class="string">"pieDemo"</span>:<span class="function"><span class="keyword">function</span>(<span class="params">val, index, series, opts</span>)</span>&#123;</span><br><span class="line">       <span class="keyword">if</span>(index !== <span class="literal">undefined</span>)&#123;</span><br><span class="line">         <span class="keyword">return</span> series[index].name+<span class="string">'：'</span>+series[index].data+<span class="string">'元'</span></span><br><span class="line">       &#125;</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h5 id="2-在组件opts上使用自定义方法format"><a href="#2-在组件opts上使用自定义方法format" class="headerlink" title="(2) 在组件opts上使用自定义方法format"></a>(2) 在组件opts上使用自定义方法<code>format</code></h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    data() &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        heartRateOpts: &#123;</span><br><span class="line">          type: <span class="string">'line'</span></span><br><span class="line">          update: <span class="literal">true</span>,</span><br><span class="line">          enableScroll: <span class="literal">true</span>, <span class="comment">// 开启x轴滚动</span></span><br><span class="line">          xAxis: &#123;</span><br><span class="line">            boundaryGap: <span class="string">'justify'</span>,</span><br><span class="line">            itemCount: <span class="number">20</span>, <span class="comment">// 开启enableScroll必须设置此字段</span></span><br><span class="line">            fontSize: <span class="number">12</span>,</span><br><span class="line">            format: <span class="string">'xyAxisEmptyData'</span>,</span><br><span class="line">            axisLineColor: <span class="string">'#EBEBEB'</span>,</span><br><span class="line">            <span class="comment">// scrollShow: true // 是否显示滚动条</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>

<hr>
<h4 id="22-使用Day-js-内额外的插件方法"><a href="#22-使用Day-js-内额外的插件方法" class="headerlink" title="22. 使用Day.js 内额外的插件方法"></a>22. <font color="#00AAF0">使用Day.js 内额外的插件方法</font></h4><p>项目中用到了 Day.js 中的查询对象是否在两个时间之间，需要用到 <code>isBetween</code> 方法，直接用的话会报错，查了一下官网的说明：</p>
<p><img src="https://img-blog.csdnimg.cn/a5ebccff43f74f6e810d7690bc84be64.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5aSn5p2v576O5byP5LiN5Yqg57OW,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="在这里插入图片描述"></p>
<p>发现需要额外引入，方法大概是通过<strong>挂载</strong>到 dayjs 函数下的 <code>extend</code> 函数加载，然后使用:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> isBetween <span class="keyword">from</span> <span class="string">'dayjs/plugin/isBetween'</span></span><br></pre></td></tr></table></figure>

<p>然后在 <code>created</code> 中挂载一下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">created() &#123;</span><br><span class="line">  dayjs.extend(isBetween)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="23-uniapp实现页面滚动到指定元素或指定位置"><a href="#23-uniapp实现页面滚动到指定元素或指定位置" class="headerlink" title="23. uniapp实现页面滚动到指定元素或指定位置"></a>23. <font color="#00AAF0">uniapp实现页面滚动到指定元素或指定位置</font></h4><p>利用 <code>uni.pageScrollTo()</code> API：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">uni.pageScrollTo(&#123;</span><br><span class="line">  selector: <span class="string">'#id'</span>, <span class="comment">// 指定元素</span></span><br><span class="line">	scrollTop: <span class="number">0</span>, <span class="comment">// 指定位置</span></span><br><span class="line">	duration: <span class="number">300</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>问题：</p>
<p>如果直接使用这个API发现根本实现不了，无论是指定元素还是位置；</p>
<p>于是找到了 <code>uni.createSelectorQuery()</code> 这个API，和 <code>boundingClientRect</code> 结合去寻找指定元素，然后获取指定元素到页面顶部的距离，再利用 <code>uni.pageScrollTo()</code> 去实现滚动，实测可行。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;view style=<span class="string">"height: 100vh;"</span>&gt;</span><br><span class="line">    &lt;view style=<span class="string">"height: 10vh;"</span> id=<span class="string">"first"</span> /&gt;</span><br><span class="line">  &lt;<span class="regexp">/view&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">	<span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    onLoad() &#123;</span><br><span class="line">      pageToscroll()</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      pageToscroll() &#123;</span><br><span class="line">        <span class="comment">// Dom都加载完成</span></span><br><span class="line">        <span class="keyword">this</span>.$nextTick(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">const</span> query = uni.createSelectorQuery().in(<span class="keyword">this</span>)</span><br><span class="line">          query.select(<span class="string">'#bottom'</span>).boundingClientRect(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'pageToscroll得到布局位置信息'</span>, res)</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'pageToscroll节点离页面顶部的距离为'</span>, res.top)</span><br><span class="line">            uni.pageScrollTo(&#123;</span><br><span class="line">              <span class="comment">// selector: '#first', // 指定元素</span></span><br><span class="line">              scrollTop: res.top, <span class="comment">// 指定位置</span></span><br><span class="line">              duration: <span class="number">0</span></span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;).exec()</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>

<hr>
<h4 id="24-uniapp子组件页面的生命周期无效"><a href="#24-uniapp子组件页面的生命周期无效" class="headerlink" title="24. uniapp子组件页面的生命周期无效"></a>24. <font color="#00AAF0">uniapp子组件页面的生命周期无效</font></h4><p>若uniapp子组件页面的生命周期(onLoad、onShow…)无效，则使用Vue自带的生命周期</p>
<hr>
<h4 id="25-UniApp-Vue3-报canvasToTempFilepath-fail-canvas-is-empty"><a href="#25-UniApp-Vue3-报canvasToTempFilepath-fail-canvas-is-empty" class="headerlink" title="25. UniApp Vue3 报canvasToTempFilepath:fail canvas is empty"></a>25. <font color="#00AAF0">UniApp Vue3 报canvasToTempFilepath:fail canvas is empty</font></h4><p>由于vue3没有<code>this</code>，那我们就创建一个当前组件的实例就可以解决问题</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> 引入<span class="string">`getCurrentInstance`</span></span><br><span class="line"><span class="keyword">import</span> &#123; getCurrentInstance &#125; <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> 声明当前实例</span><br><span class="line"><span class="keyword">const</span> instance = getCurrentInstance()</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span> 使用，eg：</span><br><span class="line"><span class="comment">// 获取上下文对象</span></span><br><span class="line"><span class="keyword">let</span> lastPoster = ref(<span class="string">''</span>)</span><br><span class="line"><span class="keyword">const</span> ctx = uni.createCanvasContext(<span class="string">'myCanvas'</span>, instance)</span><br><span class="line"><span class="comment">// await createPoster(ctx, imageMap.value)</span></span><br><span class="line">lastPoster.value = <span class="keyword">await</span> canvasToTempFilePath(<span class="string">'myCanvas'</span>, instance)</span><br></pre></td></tr></table></figure>



<hr>
<h4 id="26-HBuildx-运行-ios真机设备无法运行未签名的标准基座"><a href="#26-HBuildx-运行-ios真机设备无法运行未签名的标准基座" class="headerlink" title="26. HBuildx 运行 ios真机设备无法运行未签名的标准基座"></a>26. <font color="#00AAF0">HBuildx 运行 ios真机设备无法运行未签名的标准基座</font></h4><p><strong>需准备的工具：</strong></p>
<p>1、HBuilder 3.6.9以上</p>
<p>2、下载 爱思助手，并且通过数据线连接自己的手机</p>
<p><strong>步骤：(仅适用于 windows)</strong></p>
<p>1、如果还没有下载基座的，首先下载基座，下载好后，在HBuilder安装目录下面的</p>
<p>\plugins\launcher\base\ 目录下找到安装的ios基座：iPhone_base.ipa 。</p>
<p>如果找到了就说明安装基座成功了，就先不管他，等会要用到它。</p>
<p>下载</p>
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/8c06df707a7e629261b2b27616196ba7.png" alt="img"></p>
<p>2、HBuilder 选中要运行的项目，运行到 ios App 基座</p>
<p>3、勾选 运行到标准基座。但此时还不能直接运行，因为还没有去进行签名。</p>
<p>4、进行签名</p>
<p>将爱思助手打开，并且连接自己的手机。选中 工具箱 – IPA签名</p>
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/7a0910f22bd906085239752187e4d72f.png" alt="img"></p>
<p>选择添加 IPA文件 ，去找到刚才第一步的那个 ipa文件。</p>
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/9048b8a23aec49054b8bbe1edae730fb.png" alt="img"></p>
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/3b7da1c43f078f3122605f13fac3d7c9.png" alt="img"></p>
<p>底部选择 ”使用Apple ID签名“，并且点击 ”添加 Apple ID“ ,输入自己的 Apple ID 及密码</p>
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/ae888de44a532e831ebc03196f30451a.png" alt="img"></p>
<p>完成过后，勾选上，再点击 开始签名</p>
<p>如果签名成功，会在状态那看到 ，然后再点击 “打开已签名IPA位置”</p>
<p>会弹出这个文件。</p>
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/a39ebaec3e824dcb37c6c924ffba5532.png" alt="img"></p>
<p>然后将iPhone_base.ipa文件名称改为 iPhone_base_signed.ipa ，并且将这个文件拷贝到</p>
<p>HBuilderX安装目录\plugins\launcher\base 目录下面</p>
<p>5、上述操作完成后，打开HBuilderX，选择要运行的项目，点击工具栏运行图标，选择【运行到iOS App基座】，如下图所示，即可运行标准基座到iOS真机了。</p>
<p>6、如果没运行出来，可能是由于 iphone 没有开启 “开发者模式”，需要自己手动将开发者模式打开</p>
<p>设置—隐私与安全—开发者模式 ，打开后会提示重启手机。</p>
<p>如果你的ios系统是 16 以上，可能在 设置—隐私与安全 里面没有 “开发者模式这一项” ，</p>
<p>需要利用 爱思助手 来将选项打开。</p>
<p>6-1、打开爱思助手，最好更新到最新版，并且通过数据线连接手机。</p>
<p>6-2、工具箱 —- 虚拟定位</p>
<p>6-3、随便输入一个经纬度，点击 修改 ，然后就会提示 需要手动打开手机上的 “开发者模式”</p>
<p>6-4、在手机上，设置—隐私与安全性 里面，就能看到有”开发者选项“了，开启，然后提示重启手机。完成即可。</p>
<p>7、项目再运行过程中，还会出现提示 “未受信用的企业级开发者”，</p>
<p>需要在：设置—通用——设备管理—–点击Digtial Heaven 开头的….—信任”Digtial Heaven……信任。</p>
<p>8、完成以上操作后，就能再 ios 上，打开 HBuilder App ，就能运行你现在的项目了。</p>
<hr>
<h4 id="0-共勉"><a href="#0-共勉" class="headerlink" title="0 共勉"></a>0 <font color="#00AAF0">共勉</font></h4>
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/note/2022/09/13/JS%20CSS%20utils/" rel="next" title="JS CSS utils">
                <i class="fa fa-chevron-left"></i> JS CSS utils
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/note/images/dog.jpg"
                alt="F゛" />
            
              <p class="site-author-name" itemprop="name">F゛</p>
              <p class="site-description motion-element" itemprop="description">study hard and make progress every day!</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/note/archives/%7C%7Carchive">
              
                  <span class="site-state-item-count">24</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-uniapp中引入字体本地和在线引入"><span class="nav-number">1.</span> <span class="nav-text">1. uniapp中引入字体本地和在线引入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-解决ucharts图表X轴数据内容太多导致覆盖显示不完整"><span class="nav-number">2.</span> <span class="nav-text">2. 解决ucharts图表X轴数据内容太多导致覆盖显示不完整</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-uni-app-图片转base64-解决方案"><span class="nav-number">3.</span> <span class="nav-text">3. uni-app 图片转base64 解决方案</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-微信小程序生成海报-包含小程序二维码-插件"><span class="nav-number">4.</span> <span class="nav-text">4. 微信小程序生成海报(包含小程序二维码)(插件) </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-移动端rem布局"><span class="nav-number">5.</span> <span class="nav-text">5. 移动端rem布局</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-日期转换、比较、加减方法总结"><span class="nav-number">6.</span> <span class="nav-text">6. 日期转换、比较、加减方法总结</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-微信小程序image图片自适应宽度比例显示的方法"><span class="nav-number">7.</span> <span class="nav-text">7. 微信小程序image图片自适应宽度比例显示的方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-在uniapp中-一个页面多个视频，控制只播放一个"><span class="nav-number">8.</span> <span class="nav-text">8. 在uniapp中 一个页面多个视频，控制只播放一个</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#9-uniApp-wx小程序API-人脸录入组件"><span class="nav-number">9.</span> <span class="nav-text">9. uniApp + wx小程序API 人脸录入组件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#10-解决Uniapp-Map-APP端-show-location-不显示的问题"><span class="nav-number">10.</span> <span class="nav-text">10. 解决Uniapp Map APP端 show-location 不显示的问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#11-Uniapp-APP端点击事件失效问题"><span class="nav-number">11.</span> <span class="nav-text">11. Uniapp APP端点击事件失效问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#12-uniapp开发常见移动端IOS兼容性问题"><span class="nav-number">12.</span> <span class="nav-text">12. uniapp开发常见移动端IOS兼容性问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#13-移动端使用高德地图api调取地图并实现搜索地点的功能组件"><span class="nav-number">13.</span> <span class="nav-text">13. 移动端使用高德地图api调取地图并实现搜索地点的功能组件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#14-uCharts-图表-APP、小程序-真机不随页面滚动的问题"><span class="nav-number">14.</span> <span class="nav-text">14. uCharts 图表(APP、小程序)真机不随页面滚动的问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#15-uniapp-android-和IOS-权限-utils"><span class="nav-number">15.</span> <span class="nav-text">15 uniapp android 和IOS 权限 utils</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#16-解决uCharts图表有数据却无法显示的问题"><span class="nav-number">16.</span> <span class="nav-text">16. 解决uCharts图表有数据却无法显示的问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#17-vant-van-picker调节选项距离顶部的高度"><span class="nav-number">17.</span> <span class="nav-text">17. vant van-picker调节选项距离顶部的高度</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#18-解决uniapp在onLaunch中使用redirectTo或reLaunch跳转页面后点击事件失效问题"><span class="nav-number">18.</span> <span class="nav-text">18. 解决uniapp在onLaunch中使用redirectTo或reLaunch跳转页面后点击事件失效问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#19-uni-app开发canvas在小程序端或者h5端不生效"><span class="nav-number">19.</span> <span class="nav-text">19. uni-app开发canvas在小程序端或者h5端不生效</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#20-uCharts中图表无法横向滚动"><span class="nav-number">20.</span> <span class="nav-text">20. uCharts中图表无法横向滚动</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#21-ucharts隐藏x或y轴刻度值"><span class="nav-number">21.</span> <span class="nav-text">21. ucharts隐藏x或y轴刻度值</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-在config-ucharts-js-添加自定义方法"><span class="nav-number">21.1.</span> <span class="nav-text">(1) 在config-ucharts.js 添加自定义方法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-在组件opts上使用自定义方法format"><span class="nav-number">21.2.</span> <span class="nav-text">(2) 在组件opts上使用自定义方法format</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#22-使用Day-js-内额外的插件方法"><span class="nav-number">22.</span> <span class="nav-text">22. 使用Day.js 内额外的插件方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#23-uniapp实现页面滚动到指定元素或指定位置"><span class="nav-number">23.</span> <span class="nav-text">23. uniapp实现页面滚动到指定元素或指定位置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#24-uniapp子组件页面的生命周期无效"><span class="nav-number">24.</span> <span class="nav-text">24. uniapp子组件页面的生命周期无效</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#25-UniApp-Vue3-报canvasToTempFilepath-fail-canvas-is-empty"><span class="nav-number">25.</span> <span class="nav-text">25. UniApp Vue3 报canvasToTempFilepath:fail canvas is empty</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#26-HBuildx-运行-ios真机设备无法运行未签名的标准基座"><span class="nav-number">26.</span> <span class="nav-text">26. HBuildx 运行 ios真机设备无法运行未签名的标准基座</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#0-共勉"><span class="nav-number">27.</span> <span class="nav-text">0 共勉</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">F゛</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/note/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/note/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/note/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/note/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/note/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/note/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/note/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/note/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/note/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/note/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/note/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/note/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/note/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/note/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  


  
  <script type="text/javascript" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>
  
</body>
</html>
